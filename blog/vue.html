<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>VUE æºç  | å‰ç«¯æ—¥å¿—</title>
    <meta name="generator" content="VuePress 1.9.5">
    
    <meta name="description" content="æ¬¢è¿è®¿é—®æˆ‘çš„å‰ç«¯æ—¥å¿—">
    
    <link rel="preload" href="/assets/css/0.styles.e1700646.css" as="style"><link rel="preload" href="/assets/js/app.a0896f0e.js" as="script"><link rel="preload" href="/assets/js/2.88eb2c00.js" as="script"><link rel="preload" href="/assets/js/31.ac601726.js" as="script"><link rel="prefetch" href="/assets/js/10.d30f3d8f.js"><link rel="prefetch" href="/assets/js/11.e2b957ff.js"><link rel="prefetch" href="/assets/js/12.2da1d6bb.js"><link rel="prefetch" href="/assets/js/13.8ce2c088.js"><link rel="prefetch" href="/assets/js/14.16109f84.js"><link rel="prefetch" href="/assets/js/15.93448cfb.js"><link rel="prefetch" href="/assets/js/16.6f18825f.js"><link rel="prefetch" href="/assets/js/17.be1e4a31.js"><link rel="prefetch" href="/assets/js/18.e635c0f4.js"><link rel="prefetch" href="/assets/js/19.be17ff30.js"><link rel="prefetch" href="/assets/js/20.d142b0c9.js"><link rel="prefetch" href="/assets/js/21.e40d6d09.js"><link rel="prefetch" href="/assets/js/22.071940ae.js"><link rel="prefetch" href="/assets/js/23.99088ae7.js"><link rel="prefetch" href="/assets/js/24.670dab57.js"><link rel="prefetch" href="/assets/js/25.85694927.js"><link rel="prefetch" href="/assets/js/26.461dcdb2.js"><link rel="prefetch" href="/assets/js/27.878ab7f9.js"><link rel="prefetch" href="/assets/js/28.1fcc3f4d.js"><link rel="prefetch" href="/assets/js/29.86923448.js"><link rel="prefetch" href="/assets/js/3.037aac60.js"><link rel="prefetch" href="/assets/js/30.724a5ac7.js"><link rel="prefetch" href="/assets/js/32.765bf8d3.js"><link rel="prefetch" href="/assets/js/33.509ffbda.js"><link rel="prefetch" href="/assets/js/34.5aa96cf1.js"><link rel="prefetch" href="/assets/js/35.f1909c5d.js"><link rel="prefetch" href="/assets/js/36.36538350.js"><link rel="prefetch" href="/assets/js/37.b9375bb3.js"><link rel="prefetch" href="/assets/js/38.193abee5.js"><link rel="prefetch" href="/assets/js/39.b584d1b5.js"><link rel="prefetch" href="/assets/js/4.a0809240.js"><link rel="prefetch" href="/assets/js/40.17832949.js"><link rel="prefetch" href="/assets/js/41.cde349a4.js"><link rel="prefetch" href="/assets/js/42.67b16448.js"><link rel="prefetch" href="/assets/js/43.1b5d99f6.js"><link rel="prefetch" href="/assets/js/44.9ecb1424.js"><link rel="prefetch" href="/assets/js/5.77c6fbd3.js"><link rel="prefetch" href="/assets/js/6.609d5ed0.js"><link rel="prefetch" href="/assets/js/7.9131668e.js"><link rel="prefetch" href="/assets/js/8.f1d4a37a.js"><link rel="prefetch" href="/assets/js/9.8be87860.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e1700646.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">å‰ç«¯æ—¥å¿—</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">
  åšå®¢
</a></div><div class="nav-item"><a href="/combat/" class="nav-link">
  å®æˆ˜
</a></div><div class="nav-item"><a href="/book/" class="nav-link">
  é˜…è¯»
</a></div><div class="nav-item"><a href="https://github.com/wumao016" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">
  åšå®¢
</a></div><div class="nav-item"><a href="/combat/" class="nav-link">
  å®æˆ˜
</a></div><div class="nav-item"><a href="/book/" class="nav-link">
  é˜…è¯»
</a></div><div class="nav-item"><a href="https://github.com/wumao016" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>DevOps</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/php.html" class="sidebar-link">å·¥å…·çš„å®‰è£…</a></li><li><a href="/blog/php1.html" class="sidebar-link">PHP</a></li><li><a href="/blog/node.html" class="sidebar-link">Node.js</a></li><li><a href="/blog/webpack.html" class="sidebar-link">Webpack ä½¿ç”¨</a></li><li><a href="/blog/gulp.html" class="sidebar-link">æ„å»ºå·¥å…·å’Œè„šæ‰‹æ¶</a></li><li><a href="/blog/optimization.html" class="sidebar-link">æ€§èƒ½ä¼˜åŒ–</a></li><li><a href="/blog/nginx.html" class="sidebar-link">Nginx</a></li><li><a href="/blog/engineering.html" class="sidebar-link">å‰ç«¯å·¥ç¨‹åŒ–</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Framework</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/express.html" class="sidebar-link">Express</a></li><li><a href="/blog/koa1.html" class="sidebar-link">Koa</a></li><li><a href="/blog/vue.html" aria-current="page" class="active sidebar-link">VUE æºç </a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/vue.html#æºç ç»“æ„" class="sidebar-link">æºç ç»“æ„</a></li><li class="sidebar-sub-header"><a href="/blog/vue.html#åŒå‘æ•°æ®ç»‘å®š" class="sidebar-link">åŒå‘æ•°æ®ç»‘å®š</a></li><li class="sidebar-sub-header"><a href="/blog/vue.html#vue-setstate" class="sidebar-link">Vue SetState</a></li><li class="sidebar-sub-header"><a href="/blog/vue.html#virtual-dom" class="sidebar-link">Virtual-dom</a></li><li class="sidebar-sub-header"><a href="/blog/vue.html#vue2æ•´ä½“è§£ææµç¨‹" class="sidebar-link">Vue2æ•´ä½“è§£ææµç¨‹</a></li><li class="sidebar-sub-header"><a href="/blog/vue.html#vueè¿è¡Œæ—¶ä¼˜åŒ–" class="sidebar-link">Vueè¿è¡Œæ—¶ä¼˜åŒ–</a></li><li class="sidebar-sub-header"><a href="/blog/vue.html#vue3æºç " class="sidebar-link">Vue3æºç </a></li></ul></li><li><a href="/blog/react.html" class="sidebar-link">React ä½¿ç”¨</a></li><li><a href="/blog/uniapp.html" class="sidebar-link">Uni-appä½¿ç”¨</a></li><li><a href="/blog/ts.html" class="sidebar-link">TS ä½¿ç”¨</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>CSS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/css-3d.html" class="sidebar-link">CSSä½¿ç”¨</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/es5.html" class="sidebar-link">ES5.1</a></li><li><a href="/blog/es6.html" class="sidebar-link">ES6</a></li><li><a href="/blog/javascript-QA.html" class="sidebar-link">Javascriptä¸QAå·¥ç¨‹å¸ˆ</a></li><li><a href="/blog/js.html" class="sidebar-link">JavaScript ç²¾ç²¹</a></li><li><a href="/blog/js-function.html" class="sidebar-link">å‡½æ•°å¼ç¼–ç¨‹</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>å…¶å®ƒ</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/html.html" class="sidebar-link">åŒæºå’Œè·¨åŸŸ</a></li><li><a href="/blog/http.html" class="sidebar-link">HTTP</a></li><li><a href="/blog/write.html" class="sidebar-link">æ‰‹å†™å‡½æ•°</a></li><li><a href="/blog/test.html" class="sidebar-link">ä¹ é¢˜æ€»ç»“</a></li><li><a href="/blog/arithmetic.html" class="sidebar-link">ç®—æ³•</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="vue-æºç "><a href="#vue-æºç " class="header-anchor">#</a> VUE æºç </h1> <h3 id="æ¢è®¨å†…å®¹"><a href="#æ¢è®¨å†…å®¹" class="header-anchor">#</a> æ¢è®¨å†…å®¹</h3> <ul><li>Vueæ¶æ„æ¦‚è§ˆ</li> <li>åŒå‘æ•°æ®ç»‘å®š&amp;SetStateåŸç†</li> <li>Vue2 Virtual-dom</li> <li>Vue2 DOM Diffç®—æ³•è§£æ</li> <li>Vue2æ•´ä½“è§£ææµç¨‹</li> <li>Vueè¿è¡Œæ—¶ä¼˜åŒ–</li> <li>å†è§Vue~å‰ç«¯æŠ€æœ¯æ¡†æ¶é€‰å‹</li></ul> <h2 id="æºç ç»“æ„"><a href="#æºç ç»“æ„" class="header-anchor">#</a> æºç ç»“æ„</h2> <p>æºç ä¸‹è½½åœ°å€ <a href="https://github.com/vuejs/vue" target="_blank" rel="noopener noreferrer">æºç åœ°å€<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><img src="vue_1.png" alt="æºç ç›®å½•"></p> <p>é¦–å…ˆï¼Œç¬¬ä¸€å±‚ç›®å½•</p> <p>1.benchmarks è·‘åˆ†ã€‚æµ‹è¯•æ€§èƒ½æµ‹è¯•</p> <p>2.dist æ‰“åŒ…å‡ºçš„ä»£ç ã€‚</p> <p>3.examples ä¾‹å­ã€‚</p> <p>4.flow ç±»å‹è§„èŒƒã€‚ä¸€ä¸ªæ¡†æ¶</p> <p>5.packages ç”¨lernaæ¡†æ¶åšå‡ºæ¥ï¼Œå¤šåŒ…ç®¡ç†å·¥å…·ã€‚ eg:vue SSR-&gt;vue-server-renderer-&gt;js-&gt;VM node</p> <p>6.scripts æ‰“åŒ…è„šæœ¬ã€‚</p> <p>7.src é€»è¾‘ä»£ç ï¼Œæ ¸å¿ƒä»£ç ã€‚</p> <p>8.test æµ‹è¯•ã€‚</p> <p>9.types flowå®šä¹‰çš„tsã€‚</p> <p>åœ¨çœ‹æ ¸å¿ƒä»£ç å‰ï¼Œå…ˆåˆ†æä¸€ä¸‹distä¸­ä¸ºä»€ä¹ˆæ‰“åŒ…å‡ºæ¥å¾ˆå¤šä¸ä¸€æ ·çš„vueã€‚</p> <ul><li>Runtime only (vueè¿è¡Œæ—¶)</li> <li>Runtime+compiler (åœ¨çº¿ç¼–è¯‘) é€šè¿‡jsç¼–è¯‘æˆwith(),withè½¬æˆjs render()</li> <li>è¿˜æœ‰ä¸åŒè§„èŒƒ</li></ul> <p><strong>src æ ¸å¿ƒä»£ç ç»“æ„</strong></p> <p><img src="vue_2.png" alt="src"></p> <p>1./compiler ç›®å½•ï¼Œæ¨¡æ¿ç¼–è¯‘æ‰“åŒ…çš„è¿‡ç¨‹ï¼›(ç¦»çº¿ç¼–è¯‘) vue-&gt;jsã€‚egï¼š{i} //æµè§ˆå™¨ä¸è®¤è¯†ï¼Œæ‰€ä»¥è¦æŠŠç»„ä»¶ç¼–è¯‘æˆjs
https://vue-template-explorer.netlify.app/</p> <p>2./core â½¬å½•æ˜¯ Vue.js çš„æ ¸â¼¼(ä¹Ÿæ˜¯åé¢çš„é‡ç‚¹)ï¼›</p> <p>3./platforms â½¬å½•æ˜¯é’ˆå¯¹æ ¸â¼¼æ¨¡å—çš„ â€˜å¹³å°â€™ æ¨¡å—ï¼Œ</p> <p>4.platforms ç›®å½•ä¸‹æœ‰ webã€ weex â½¬å½•ã€‚ web ç›®å½•ä¸‹æœ‰å¯¹åº”çš„ /compilerã€ /runtimeã€
/serverã€ /utilç›®å½•ï¼›ï¼ˆè¿™é‡Œçš„compileræ˜¯åœ¨çº¿ç¼–è¯‘ï¼Œå¤–é¢çš„compileræ˜¯ç¦»çº¿ç¼–è¯‘ï¼‰</p> <p>5./server ç›®å½•æ˜¯å¤„ï§¤æœåŠ¡ç«¯æ¸²æŸ“ï¼›</p> <p>6./sfc ç›®å½•å¤„ï§¤å•â½‚ä»¶ .vueï¼›</p> <p>7./shared ç›®å½•æä¾›å…¨å±€ç”¨åˆ°çš„å·¥å…·</p> <p>ç»“è®ºï¼šVue.js çš„ç»„æˆæ˜¯ç”± core + å¯¹åº”çš„ â€˜å¹³å°â€™ è¡¥å……ä»£ç æ„æˆï¼ˆç‹¬ç«‹æ„å»ºå’Œè¿è¡Œæ—¶æ„å»º
åªæ˜¯ platforms ä¸‹ web å¹³å°çš„ä¸¤ç§é€‰æ‹©ï¼‰ã€‚
<img src="vue_3.png" alt="core"></p> <h2 id="åŒå‘æ•°æ®ç»‘å®š"><a href="#åŒå‘æ•°æ®ç»‘å®š" class="header-anchor">#</a> åŒå‘æ•°æ®ç»‘å®š</h2> <p><strong>åŒå‘ç»‘å®šï¼ˆå“åº”å¼åŸç†ï¼‰æ‰€æ¶‰åŠåˆ°çš„æŠ€æœ¯</strong></p> <ul><li>1.Object.defineProperty</li> <li>2.Observer</li> <li>3.Watcher</li> <li>4.Dep</li> <li>5.Directive
<img src="vue_4.png" alt="åŒå‘æ•°æ®ç»‘å®š"></li></ul> <h3 id="_1-object-defineproperty"><a href="#_1-object-defineproperty" class="header-anchor">#</a> 1.Object.defineProperty</h3> <p><img src="vue_5.png" alt="defineProperty"> <strong>æ€»ç»“</strong></p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code>&lt;span<span class="token punctuation">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>a<span class="token punctuation">}</span><span class="token punctuation">}</span>&lt;/span<span class="token punctuation">&gt;</span> <span class="token punctuation">-</span><span class="token punctuation">&gt;</span> getter <span class="token punctuation">-</span><span class="token punctuation">&gt;</span> watcher <span class="token punctuation">-</span><span class="token punctuation">&gt;</span> dep(å¹¶ä¸”è¿”å›æ•°æ®æ¸²æŸ“)<span class="token punctuation">{</span>a<span class="token punctuation">:</span>watcher<span class="token punctuation">}</span>

                   <span class="token punctuation">-</span><span class="token punctuation">&gt;</span> setter <span class="token punctuation">-</span><span class="token punctuation">&gt;</span>dep <span class="token punctuation">-</span><span class="token punctuation">&gt;</span> <span class="token punctuation">{</span>a<span class="token punctuation">:</span>watcher<span class="token punctuation">}</span> <span class="token punctuation">-</span><span class="token punctuation">&gt;</span> &lt;span<span class="token punctuation">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>a<span class="token punctuation">}</span><span class="token punctuation">}</span>&lt;/span<span class="token punctuation">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><img src="vue_9.png" alt="defineProperty">
setter è§¦å‘æ¶ˆæ¯åˆ° Watcher watcherå¸®å¿™å‘Šè¯‰ Directive æ›´æ–° DOMï¼ŒDOMä¸­ä¿®æ”¹äº†æ•°æ®ä¹Ÿä¼šé€šçŸ¥Watcherï¼Œwatcherå¸®å¿™ä¿®æ”¹æ•°æ®ã€‚</p> <h3 id="_2-observer"><a href="#_2-observer" class="header-anchor">#</a> 2.Observer</h3> <p><img src="vue_6.png" alt="observer"> <img src="vue_7.png" alt="observer"> <strong>src/core/observer/index.js</strong> ,<strong>src/core/observer/array.js</strong></p> <p><strong>Observerä¸»è¦å¤„ç†è¿‡ç¨‹ï¼š</strong></p> <p>Observerä¼šè§‚å¯Ÿä¸¤ç§ç±»å‹çš„æ•°æ®ï¼ŒObject ä¸ Array</p> <p>å¯¹äºArrayç±»å‹çš„æ•°æ®ï¼Œç”±äº JavaScript çš„é™åˆ¶ï¼Œ Vue ä¸èƒ½æ£€æµ‹å˜åŒ–,ä¼šå…ˆé‡å†™æ“ä½œæ•°ç»„
çš„åŸå‹æ–¹æ³•ï¼Œé‡å†™åèƒ½è¾¾åˆ°ä¸¤ä¸ªç›®çš„ï¼Œ</p> <p>1.å½“æ•°ç»„å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè§¦å‘ notify</p> <p>å¦‚æœæ˜¯ pushï¼Œunshiftï¼Œsplice è¿™äº›æ·»åŠ æ–°å…ƒç´ çš„æ“ä½œï¼Œåˆ™ä¼šä½¿ç”¨observerè§‚å¯Ÿæ–°æ·»åŠ çš„
æ•°æ®</p> <p>é‡å†™å®ŒåŸå‹æ–¹æ³•åï¼Œéå†æ‹¿åˆ°æ•°ç»„ä¸­çš„æ¯ä¸ªæ•°æ® ä½¿ç”¨observerè§‚å¯Ÿå®ƒ</p> <p>2.è€Œå¯¹äºObjectç±»å‹çš„æ•°æ®ï¼Œåˆ™éå†å®ƒçš„æ¯ä¸ªkeyï¼Œä½¿ç”¨ defineProperty è®¾ç½® getter å’Œ
setterï¼Œå½“è§¦å‘getterçš„æ—¶å€™ï¼Œobserveråˆ™å¼€å§‹æ”¶é›†ä¾èµ–ï¼Œè€Œè§¦å‘setterçš„æ—¶å€™ï¼Œobserve
åˆ™è§¦å‘notifyã€‚
<img src="vue_8.png" alt="observer"> <strong>æ€»ç»“observer</strong></p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code>observer(data) <span class="token punctuation">-</span><span class="token punctuation">&gt;</span> æ˜¯å¦æ˜¯æ•°ç»„
                 æ˜¯<span class="token punctuation">-</span><span class="token punctuation">&gt;</span>é‡å†™æ•°ç»„
   			      1.arr=<span class="token punctuation">[</span><span class="token punctuation">]</span>._proto_=ArrayMethed<span class="token punctuation">{</span><span class="token punctuation">}</span>
   				  ArrayMethed<span class="token punctuation">-</span><span class="token punctuation">&gt;</span>ç»§æ‰¿äº†<span class="token punctuation">-</span><span class="token punctuation">&gt;</span>æ•°ç»„æ–¹æ³•ï¼ˆæ‹¦æˆª defï¼‰
                 å¦<span class="token punctuation">-</span><span class="token punctuation">&gt;</span>this.walk<span class="token punctuation">-</span><span class="token punctuation">&gt;</span>object.key(<span class="token punctuation">{</span><span class="token punctuation">}</span>)<span class="token punctuation">-</span><span class="token punctuation">&gt;</span>éå†æ‰€æœ‰çš„key(object.defineProperty)
   			  object.defineProperty(
   			     get<span class="token punctuation">:</span>//æŠŠå¯¹åº”çš„ä¾èµ–æ”¶é›†åˆ°ç”µè¯æœ¬Dep.push()
   				 set<span class="token punctuation">:</span>//åˆ†å‘ï¼Œè§¦å‘æ‰€æœ‰ä¾èµ– éå†Depç”µè¯æœ¬
   			  )
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_3-watcher"><a href="#_3-watcher" class="header-anchor">#</a> 3.Watcher</h3> <p><strong>src/core/observer/watcher.js</strong></p> <p>Watcher æ˜¯å°†æ¨¡æ¿å’Œ Observer å¯¹è±¡ç»“åˆåœ¨ä¸€èµ·çš„çº½å¸¦ã€‚Watcher æ˜¯è®¢é˜…è€…æ¨¡å¼ä¸­çš„è®¢é˜…è€…ã€‚Watcher çš„ä¸¤
ä¸ªå‚æ•°ï¼š expOrFn æœ€ç»ˆä¼šè¢«è½¬æ¢ä¸º getter å‡½æ•°ï¼Œ cb æ˜¯æ›´æ–°æ—¶æ‰§è¡Œçš„å›è°ƒã€‚ä¾èµ–æ”¶é›†çš„å…¥å£å°±æ˜¯getå‡½æ•°ã€‚
<img src="vue_10.png" alt="watcher">
getter å‡½æ•°æ˜¯ç”¨æ¥è¿æ¥ç›‘æ§å±æ€§ä¸ Watcher çš„å…³é”®ã€‚
<img src="vue_11.png" alt="watcher"></p> <h3 id="_4-dep"><a href="#_4-dep" class="header-anchor">#</a> 4.Dep</h3> <p><strong>src/core/observer/dep.js</strong> <img src="vue_12.png" alt="dep"></p> <h3 id="_5-directive"><a href="#_5-directive" class="header-anchor">#</a> 5.Directive</h3> <p><img src="vue_13.png" alt="directive">
vueå†…ç½®äº†è¿™ä¹ˆå¤šçš„æŒ‡ä»¤ï¼Œè¿™äº›æŒ‡ä»¤éƒ½ä¼šæŠ›å‡ºä¸¤ä¸ªæ¥å£bind å’Œ updateï¼Œè¿™ä¸¤ä¸ªæ¥å£çš„ä½œç”¨æ˜¯ï¼Œç¼–è¯‘çš„æœ€åä¸€æ­¥æ˜¯æ‰§è¡Œæ‰€æœ‰ç”¨åˆ°çš„æŒ‡ä»¤çš„bindæ–¹
æ³•ï¼Œè€Œ update æ–¹æ³•åˆ™æ˜¯å½“watcher è§¦å‘ update æ—¶ï¼ŒDirectiveä¼šè§¦å‘æŒ‡ä»¤çš„updateæ–¹æ³•</p> <p>observe -&gt; è§¦å‘setter -&gt;</p> <p>watcher -&gt; è§¦å‘update -&gt;</p> <p>Directive -&gt; è§¦å‘update -&gt;</p> <p>æŒ‡ä»¤</p> <h3 id="å®è·µ"><a href="#å®è·µ" class="header-anchor">#</a> å®è·µ</h3> <p>æ‰‹å†™å®ç°æ•°æ®åŒå‘ç»‘å®šï¼Œ<a href="https://github.com/wumao016/myVue" target="_blank" rel="noopener noreferrer">ä»£ç åœ°å€<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <blockquote><p>å…¶ä»–çš„ä¸€äº›ä»£ç è§£æ</p></blockquote> <p><strong>1.vue.useçš„å®ç°</strong> <strong>src/core/global-api/use.js</strong> <img src="vue_14.png" alt="use"></p> <h2 id="vue-setstate"><a href="#vue-setstate" class="header-anchor">#</a> Vue SetState</h2> <p>æ€»ç»“</p> <p>1.Batch Update</p> <p>2.Transactionå¯¹ä¸€ä¸ªå‡½æ•°è¿›è¡ŒåŒ…è£…ï¼Œè®©Reactæœ‰æœºä¼šåœ¨ä¸€ä¸ªå‡½æ•°æ‰§è¡Œå‰å’Œæ‰§è¡Œåè¿è¡Œç‰¹å®šçš„é€»è¾‘ï¼Œä»
è€Œå®Œæˆå¯¹æ•´ä¸ªBatch Updateæµç¨‹çš„æ§åˆ¶ã€‚</p> <p>ç®€å•çš„è¯´å°±æ˜¯åœ¨è¦æ‰§è¡Œçš„å‡½æ•°ä¸­ç”¨äº‹åŠ¡åŒ…è£¹èµ·æ¥ï¼Œåœ¨å‡½æ•°æ‰§è¡Œå‰åŠ å…¥initializeé˜¶æ®µï¼Œå‡½æ•°æ‰§è¡Œï¼Œæœ€å
æ‰§è¡Œcloseé˜¶æ®µã€‚é‚£ä¹ˆBatch Updateä¸­</p> <p>åœ¨äº‹ä»¶initializeé˜¶æ®µï¼Œä¸€ä¸ªupdate queueè¢«åˆ›å»ºã€‚åœ¨äº‹ä»¶ä¸­è°ƒç”¨setStateæ–¹æ³•æ—¶ï¼ŒçŠ¶æ€ä¸ä¼šè¢«ç«‹å³è°ƒ
ç”¨ï¼Œè€Œæ˜¯è¢«pushè¿›Update queueä¸­ã€‚</p> <p>å‡½æ•°æ‰§è¡Œç»“æŸè°ƒç”¨äº‹ä»¶çš„closeé˜¶æ®µï¼ŒUpdate queueä¼šè¢«flushï¼Œè¿™äº‹æ–°çš„çŠ¶æ€æ‰ä¼šè¢«åº”ç”¨åˆ°ç»„ä»¶ä¸Šå¹¶å¼€
å§‹åç»­çš„Virtual DOMæ›´æ–°ï¼Œbiffç®—æ³•æ¥å¯¹modelæ›´æ–°ã€‚</p> <p>3.å½“modelè¢«ä¿®æ”¹æ—¶ï¼Œå¯¹åº”çš„watcherä¼šè¢«æ¨å…¥Update queueï¼Œ ä¸æ­¤åŒæ—¶è¿˜ä¼šåœ¨å¼‚æ­¥é˜Ÿåˆ—ä¸­æ·»åŠ ä¸€ä¸ªtaskç”¨äºflush
å½“å‰çš„Update queueã€‚</p> <p>è¿™æ ·ä¸€æ¥ï¼Œå½“å‰çš„taskä¸­çš„å…¶ä»–watcherä¼šè¢«æ¨è¿›åŒä¸€ä¸ªUpdate queueä¸­ã€‚å½“å‰taskæ‰§è¡Œç»“æŸåï¼Œå¼‚æ­¥é˜Ÿåˆ—ä¸‹ä¸€ä¸ª
taskæ‰§è¡Œï¼Œupdate queue
ä¼šè¢« flushï¼Œå¹¶è¿›è¡Œåç»­çš„æ›´æ–°æ“ä½œã€‚
ä¸ºäº†è®© flush åŠ¨ä½œèƒ½åœ¨å½“å‰ Task ç»“æŸåå°½å¯èƒ½æ—©çš„å¼€å§‹ï¼ŒVue ä¼šä¼˜å…ˆå°è¯•å°†ä»»åŠ¡ micro-task é˜Ÿåˆ—ï¼Œå…·ä½“æ¥è¯´ï¼Œ
åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­ Vue ä¼šä¼˜
å…ˆå°è¯•ä½¿ç”¨ MutationObserver API æˆ– Promiseï¼Œå¦‚æœä¸¤è€…éƒ½ä¸å¯ç”¨ï¼Œåˆ™ fallback åˆ° setTimeoutã€‚
å¯¹æ¯”ä¸¤ä¸ªæ¡†æ¶å¯ä»¥å‘ç° React åŸºäº Transition å®ç°çš„ Batch Query æ˜¯ä¸€ä¸ªä¸ä¾èµ–è¯­è¨€ç‰¹æ€§çš„é€šç”¨æ¨¡å¼ï¼Œå› æ­¤æœ‰
æ›´ç¨³å®šå¯æ§çš„è¡¨ç°ï¼Œä½†ç¼ºç‚¹æ˜¯æ— æ³•å®Œå…¨è¦†ç›–æ‰€æœ‰æƒ…å†µ</p> <h2 id="virtual-dom"><a href="#virtual-dom" class="header-anchor">#</a> Virtual-dom</h2> <p>DOMæ“ä½œå¾ˆæ…¢æ˜¯ä¸¤ä¸ªåŸå› ï¼Œä¸€ä¸ªæ˜¯æœ¬èº«æ“ä½œå°±ä¸å¿«ï¼Œç¬¬
äºŒæ˜¯æˆ‘ä»¬ï¼ˆè¿˜æœ‰å¾ˆå¤šæ¡†æ¶ï¼‰å¤„ç†domçš„æ–¹å¼å¾ˆæ…¢ï¼ŒVirtual
Domè§£å†³äº†æˆ‘ä»¬è¿™äº›æ„šè ¢çš„ç¨‹åºå‘˜å¯¹Domçš„ä½åŠ£æ“ä½œï¼Œå®ƒè®©æˆ‘
ä»¬ä¸éœ€è¦è¿›è¡ŒDomæ“ä½œï¼Œè€Œæ˜¯å°†å¸Œæœ›å±•ç°çš„æœ€ç»ˆç»“æœå‘Šè¯‰
React(vue)ï¼ŒReact(vue)é€šè¿‡ä¸€ä¸ªç®€åŒ–çš„Domå³Virtual domè¿›è¡Œ
renderï¼Œå½“ä½ è¯•å›¾æ”¹å˜æ˜¾ç¤ºå†…å®¹æ—¶ï¼Œæ–°ç”Ÿæˆçš„Virtual Domä¼š
ä¸ç°åœ¨çš„Virtual domå¯¹æ¯”ï¼Œé€šè¿‡diffç®—æ³•æ‰¾åˆ°åŒºåˆ«ï¼Œè¿™äº›æ“ä½œ
éƒ½æ˜¯åœ¨å¿«é€Ÿçš„jsä¸­å®Œæˆçš„ï¼Œæœ€åå¯¹å®é™…Domè¿›è¡Œæœ€å°çš„Domæ“
ä½œæ¥å®Œæˆæ•ˆæœï¼Œè¿™å°±æ˜¯Virtual Domçš„æ¦‚å¿µã€‚
rective(descriptor, this, node, host, scope, frag)</p> <blockquote><p>Virtual-dom</p></blockquote> <p>â€˜Virtual-domâ€™æ˜¯ä¸€ç³»åˆ—çš„æ¨¡å—é›†åˆï¼Œç”¨æ¥æä¾›å£°æ˜å¼çš„DOMæ¸²æŸ“ã€‚æ¥çœ‹ä¸€ä¸ªç®€å•çš„ DOM ç‰‡æ®µ.
æœ¬è´¨ä¸Šå°±æ˜¯åœ¨ JS å’Œ DOM ä¹‹é—´åšäº†ä¸€ä¸ªç¼“å­˜ã€‚å¯ä»¥ç±»æ¯” CPU å’Œç¡¬ç›˜ï¼Œæ—¢ç„¶ç¡¬ç›˜è¿™ä¹ˆæ…¢ï¼Œæˆ‘
ä»¬å°±åœ¨å®ƒä»¬ä¹‹é—´åŠ ä¸ªç¼“å­˜ï¼šæ—¢ç„¶ DOM è¿™ä¹ˆæ…¢ï¼Œæˆ‘ä»¬å°±åœ¨å®ƒä»¬ JS å’Œ DOM ä¹‹é—´åŠ ä¸ªç¼“å­˜ã€‚
CPUï¼ˆJSï¼‰åªæ“ä½œå†…å­˜ï¼ˆVirtual DOMï¼‰ï¼Œæœ€åçš„æ—¶å€™å†æŠŠå˜æ›´å†™å…¥ç¡¬ç›˜ï¼ˆDOMï¼‰ã€‚
<img src="vue_15.png" alt="dom"> <strong>VIRTUAL-DOM-&gt;CORE/VDOM/CREATE-ELEMENT.JS</strong> <img src="vue_16.png" alt="dom"></p> <h2 id="vue2æ•´ä½“è§£ææµç¨‹"><a href="#vue2æ•´ä½“è§£ææµç¨‹" class="header-anchor">#</a> Vue2æ•´ä½“è§£ææµç¨‹</h2> <p><img src="vue_17.png" alt="ç”Ÿå‘½å‘¨æœŸ"> <img src="vue_18.png" alt="ç”Ÿå‘½å‘¨æœŸ">
2.0 çš„ç‰ˆæœ¬ä¸­è¿™ä¸€å—æœ‰å¾ˆå¤§çš„æ”¹åŠ¨ï¼Œ1.0 çš„ç‰ˆæœ¬ä¸­ Vue ä½¿ç”¨çš„æ˜¯ DocumentFragment æ¥è¿›è¡Œæ¨¡æ¿è§£
æï¼Œè€Œ 2.0 ä¸­ä½œè€…é‡‡ç”¨çš„ John Resig çš„ HTML Parser å°†æ¨¡æ¿è§£ææˆå¯ç›´æ¥æ‰§è¡Œçš„ render å‡½æ•°ï¼Œè¿™æ˜¯
æ¨¡æ¿é¢„ç¼–è¯‘å’ŒæœåŠ¡ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰çš„å‰æï¼›</p> <h2 id="vueè¿è¡Œæ—¶ä¼˜åŒ–"><a href="#vueè¿è¡Œæ—¶ä¼˜åŒ–" class="header-anchor">#</a> Vueè¿è¡Œæ—¶ä¼˜åŒ–</h2> <p><img src="vue_19.png" alt="ä¼˜åŒ–"> <img src="vue_20.png" alt="ä¼˜åŒ–"></p> <h2 id="vue3æºç "><a href="#vue3æºç " class="header-anchor">#</a> Vue3æºç </h2> <p>æºç åœ°å€<a href="https://github.com/vuejs/vue-next" target="_blank" rel="noopener noreferrer">æºç åœ°å€<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>åŒºåˆ«</strong></p> <p>1.tempalteï¼švue2-&gt;æ­£åˆ™,   vue3-&gt;è¯æ³•åˆ†æ-&gt;è¯­æ³•åˆ†æ-&gt;AST</p> <p>2.æ ¸å¿ƒé€»è¾‘ object.defineproperty-&gt;proxy</p> <p><strong>æå‡</strong></p> <p>1.æ€§èƒ½ æ¨¡ç‰ˆè§£æçš„ä¼˜åŒ–ï¼Œç»„ä»¶ä¼˜åŒ–ï¼Œè™šæ‹Ÿdomä¼˜åŒ–</p> <p>2.tree shaking vue2æ‰“åŒ…å‡ºæ¥ -ã€‹vue.min.js vue.runtime.min.js, vue3 -ã€‹æ•°æ®å“åº”å¤„ç†ï¼Œæ¨¡ç‰ˆè§£æå¤„ç†ï¼Œç«¯å¤„ç†ã€‚</p> <p>3.composition API</p> <p>4.ts proxy</p> <h3 id="æ¨¡ç‰ˆè§£æ"><a href="#æ¨¡ç‰ˆè§£æ" class="header-anchor">#</a> æ¨¡ç‰ˆè§£æ</h3> <p>å®˜æ–¹æ¨¡ç‰ˆè§£æ<a href="https://vue-next-template-explorer.netlify.app/" target="_blank" rel="noopener noreferrer">åœ°å€<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>è¯æ³•åˆ†æ</strong></p> <p>é€šè¿‡ä¸€ä¸ªè§„èŒƒæŠŠæ¨¡ç‰ˆåˆ†æï¼Œ<a href="https://github.com/antlr/grammars-v4" target="_blank" rel="noopener noreferrer">è¯æ³•åˆ†æå‚è€ƒè§„åˆ™<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>ï¼Œè§£ææˆtonkenï¼Œå†ç»è¿‡è¯­æ³•åˆ†æï¼Œå°±ä¼šå½¢æˆAST</p> <h3 id="æ•°æ®åŒå‘å“åº”"><a href="#æ•°æ®åŒå‘å“åº”" class="header-anchor">#</a> æ•°æ®åŒå‘å“åº”</h3> <p><strong>proxy</strong></p> <p>vue3çš„æ•°æ®åŒå‘å“åº”ç”¨çš„æ˜¯proxyï¼Œproxyè‡ªèº«æœ‰ä¸€äº›ç¼ºç‚¹ï¼š</p> <p>1.æ•°æ®æŒªåŠ¨ å¤šæ¬¡è§¦å‘ã€‚</p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code>var data=<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span>;
var p=new Proxy(data<span class="token punctuation">,</span><span class="token punctuation">{</span>
	get(target<span class="token punctuation">,</span>key<span class="token punctuation">,</span>receiver)<span class="token punctuation">{</span>
		console.log('get value'<span class="token punctuation">,</span>key);
		return Reflect.get(target<span class="token punctuation">,</span>key<span class="token punctuation">,</span>receiver)
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	set(target<span class="token punctuation">,</span>key<span class="token punctuation">,</span>value<span class="token punctuation">,</span>receiver)<span class="token punctuation">{</span>
		console.log('set value'<span class="token punctuation">,</span>key);
		return Reflect.set(target<span class="token punctuation">,</span>key<span class="token punctuation">,</span>value<span class="token punctuation">,</span>receiver)
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>2.ä¸èƒ½æ‹¦æˆªæ·±å±‚æ¬¡çš„å¯¹è±¡æ•°æ®ï¼ˆvue3çš„å¤„ç†æ˜¯ï¼Œå¯¹äºæ·±å±‚æ¬¡åµŒå¥—çš„å¯¹è±¡ï¼Œä¸€å¼€å§‹æ²¡æœ‰é€’å½’ï¼Œæ˜¯åœ¨è·å–çš„æ—¶å€™åˆ¤æ–­æ˜¯å¦æ˜¯å¯¹è±¡ï¼Œå†å¤„ç†æˆä¸ºå“åº”å¼æ•°æ®ï¼‰ã€‚</p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code>var data=<span class="token punctuation">{</span>
	foo<span class="token punctuation">:</span><span class="token punctuation">{</span>
		bar<span class="token punctuation">:</span><span class="token number">1</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
var p=reactive(data)
function reactive(data)<span class="token punctuation">{</span>
	return new Proxy(data<span class="token punctuation">,</span><span class="token punctuation">{</span>
		get(target<span class="token punctuation">,</span>key<span class="token punctuation">,</span>receiver)<span class="token punctuation">{</span>
			console.log('get value'<span class="token punctuation">,</span>key);
			var res=Reflect.get(target<span class="token punctuation">,</span>key<span class="token punctuation">,</span>receiver)
			if(typeof res=='object')<span class="token punctuation">{</span>
				return reactive(res)
			<span class="token punctuation">}</span>
			return res
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		set(target<span class="token punctuation">,</span>key<span class="token punctuation">,</span>value<span class="token punctuation">,</span>receiver)<span class="token punctuation">{</span>
			console.log('set value'<span class="token punctuation">,</span>key);
			return Reflect.set(target<span class="token punctuation">,</span>key<span class="token punctuation">,</span>value<span class="token punctuation">,</span>receiver)
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>)
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><blockquote><p>vue3 packagesç›®å½•åˆ†æ</p></blockquote> <ul><li>compiler-core -ã€‹ç¼–è¯‘å™¨</li> <li>compiler-dom -ã€‹é’ˆå¯¹æµè§ˆå™¨è€Œè¨€çš„ç¼–è¯‘å™¨</li> <li>reactivity -ã€‹ç›¸å½“äºvue2çš„observer -ã€‹æ•°æ®å“åº”ç³»ç»Ÿ</li> <li>runtime-core -ã€‹è¿è¡Œæ—¶</li> <li>runtime-dom -ã€‹ä¸“é—¨é’ˆå¯¹äºæµè§ˆå™¨çš„è¿è¡Œæ—¶çš„</li> <li>server-renderer -ã€‹æœåŠ¡ç«¯æ¸²æŸ“</li></ul> <p><strong>reactivity</strong></p> <p>æ•°æ®å“åº”æ¶æ„
<img src="vue_21.png" alt="æ¶æ„"></p> <h3 id="vue3ä¸vue2æ¯”è¾ƒ"><a href="#vue3ä¸vue2æ¯”è¾ƒ" class="header-anchor">#</a> vue3ä¸vue2æ¯”è¾ƒ</h3> <p><strong>vue2 options API</strong></p> <ul><li>beforeCreate</li> <li>created</li> <li>beforeMount</li> <li>mounted</li> <li>beforeUpdate</li> <li>updated</li> <li>beforeDestory</li> <li>destoryed</li> <li>errorCaptured</li></ul> <p><strong>vue3 composition API</strong></p> <ul><li>setup()</li> <li>onBeforeMount</li> <li>onMounted</li> <li>onBeforeUpdate</li> <li>onUpdated</li> <li>onBeforeUnmount</li> <li>onUnmounted</li> <li>onErrorCaptured</li></ul> <p><strong>vue2 basic</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  el<span class="token operator">:</span> <span class="token string">&quot;#app&quot;</span><span class="token punctuation">,</span>
  template<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    &lt;div&gt;
        &lt;div&gt;Count is: {{ this.count }}, double is: {{ this.double }}&lt;/div&gt;
        &lt;button @click=&quot;increment&quot;&gt;Add&lt;/button&gt;
    &lt;/div&gt;
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  data<span class="token operator">:</span> <span class="token punctuation">{</span>
    count<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  computed<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">double</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>count<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//htmlé‡Œç›´æ¥å¼•å…¥</span>
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;./js/setup_v2.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p><strong>vue3 basic</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> reactive<span class="token punctuation">,</span> computed <span class="token punctuation">}</span> <span class="token operator">=</span> Vue<span class="token punctuation">;</span>
<span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token punctuation">{</span>
  template<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
        &lt;div&gt;Count is: {{ state.count }}, double is: {{ state.double }}&lt;/div&gt;
        &lt;button @click=&quot;increment&quot;&gt;Add&lt;/button&gt;
    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;ğŸ»&quot;</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//window</span>
    <span class="token comment">// åˆ›å»ºå“åº”æ•°æ®</span>
    <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      count<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      double<span class="token operator">:</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>count <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">function</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      state<span class="token punctuation">.</span>count<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      state<span class="token punctuation">,</span>
      increment<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//htmlé‡Œ</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> <span class="token operator">=</span> Vue<span class="token punctuation">;</span>
  <span class="token comment">// æœ€æ–°alphaç‰ˆæœ¬ä¸­å†™æ³•å˜äº†</span>
  <span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">&quot;#app&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p><strong>vue3 setup</strong></p> <ul><li>1.setupæ˜¯ä¸€ä¸ªæ–°çš„ç»„ä»¶é€‰é¡¹ï¼Œä¹Ÿæ˜¯å…¶ä»–APIçš„å…¥å£ã€‚
ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ æ‰€æœ‰çš„æ“ä½œéƒ½å°†åœ¨setupå‡½æ•°å†…éƒ¨å®šä¹‰å’Œæ‰§è¡Œï¼Œ
Vue3.0ä¹Ÿå°†ç”¨å‡½æ•°ä»£æ›¿Vue2.xçš„ç±»ä¹Ÿå°±æ˜¯new Vue()</li> <li>2.setup ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯props,è¿™é‡Œçš„propså’ŒVue2.xä¸­çš„propsä¸€è‡´ã€‚</li> <li>3.ä½•æ—¶è°ƒç”¨ï¼Ÿsetupæ˜¯åœ¨ä¸€ä¸ªç»„ä»¶å®ä¾‹è¢«åˆ›å»ºæ—¶ï¼Œåˆå§‹åŒ–äº† props ä¹‹åè°ƒç”¨ï¼Œ
å…¶å®å°±æ˜¯å–ä»£äº†Vue2.xçš„caretedå’ŒbeforeCreateã€‚</li> <li>4.setupè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡ä¸­çš„å±æ€§å°†ç›´æ¥æš´éœ²ç»™æ¨¡æ¿æ¸²æŸ“çš„ä¸Šä¸‹æ–‡ã€‚
è€Œåœ¨Vue2.xä¸­ï¼Œä½ å®šä¹‰çš„å±æ€§éƒ½ä¼šè¢«Vueå†…éƒ¨æ— æ¡ä»¶æš´éœ²ç»™æ¨¡æ¿æ¸²æŸ“ä¸Šä¸‹æ–‡ã€‚</li> <li>5.setupç¬¬äºŒä¸ªå‚æ•°(context)æä¾›ä¸€ä¸ªä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œè¿™ä¸ªä¸Šä¸‹æ–‡å¯¹è±¡æä¾›ä¸€ä¸ªå¯é€‰çš„å±æ€§åˆ—è¡¨ï¼Œå’ŒVue2.xä¸­æŒ‚è½½åœ¨thisä¸Šçš„å±æ€§åˆ—è¡¨ä¸€è‡´ã€‚contextå…·æœ‰ä¸this.$attrsï¼Œthis.$slotsï¼Œthis.$emitï¼Œthis.$parentï¼Œthis.$rootå¯¹åº”çš„å±æ€§ï¼ˆå±æ€§ï¼Œæ’æ§½ï¼Œemitï¼Œparentï¼Œrootï¼‰ã€‚</li></ul> <p><code>1.propså¯¹æ¯”Vue2.xä¸»è¦è¦æ³¨æ„çš„åœ°æ–¹ (1)Vue2.xä¸­propsç»‘å®šåœ¨thisä¸Šï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡this.props.propsNameè·å–å¯¹åº”çš„å€¼ï¼Œ Vue3.0åPropså°†å˜æˆsetupçš„ç¬¬ä¸€ä¸ªå‚æ•°,è€Œsetupä¹Ÿæ˜¯åœ¨åˆå§‹åŒ–propsä¹‹åæ‰è¢«è°ƒç”¨ã€‚æœ‰ç‚¹åƒæŸactçš„æ„Ÿè§‰ (2)ç±»å‹å®šä¹‰çš„æ—¶å€™ï¼Œä»ç„¶å¯ä»¥åƒVue2.xä¸€æ ·ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒTS (3)props å¯¹è±¡æ˜¯å“åº”å¼çš„ â€”â€” å®ƒå¯ä»¥è¢«å½“ä½œæ•°æ®æºå»è§‚æµ‹ï¼Œå½“åç»­ props å‘ç”Ÿå˜åŠ¨æ—¶å®ƒä¹Ÿä¼šè¢«æ¡†æ¶å†…éƒ¨åŒæ­¥æ›´æ–°ã€‚ ä½†å¯¹äºç”¨æˆ·ä»£ç æ¥è¯´ï¼Œå®ƒæ˜¯ä¸å¯ä¿®æ”¹çš„ï¼ˆä¼šå¯¼è‡´è­¦å‘Šï¼‰</code></p> <p><strong>vue3 rective</strong></p> <ul><li>vue2é‡Œæ²¡æœ‰rectiveï¼Œç›¸å½“äºdate</li> <li>vue3 æ•°æ®ç›‘å¬å‡½æ•°</li> <li>1.reactiveå‡½æ•°æ¥æ”¶ä¸€ä¸ªå¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œè¿”å›è¿™ä¸ªå¯¹è±¡çš„å“åº”å¼ä»£ç†ï¼Œç­‰ä»·Vue2.xçš„Vue.observable()</li> <li>2.å¯¹æ¯”Vue2.xçš„observable()ï¼Œç»„ä»¶å®ä¾‹åœ¨åˆå§‹åŒ–çš„æ—¶å€™ä¼šå°† data æ•´ä¸ªå¯¹è±¡å˜ä¸ºå¯è§‚å¯Ÿå¯¹è±¡ï¼Œ
é€šè¿‡é€’å½’çš„æ–¹å¼ç»™æ¯ä¸ª Key ä½¿ç”¨ Object.defineProperty åŠ ä¸Š getter å’Œ settter ï¼Œ
å¦‚æœæ˜¯æ•°ç»„å°±é‡å†™ä»£ç†æ•°ç»„å¯¹è±¡çš„ä¸ƒä¸ªæ–¹æ³•ã€‚è™½ç„¶ç»™æˆ‘ä»¬å¸¦æ¥çš„ä¾¿åˆ©ï¼Œä½†æ˜¯åœ¨å¤§å‹é¡¹ç›®ä¸Šæ¥è¯´ï¼Œæ€§èƒ½å¼€é”€å°±å¾ˆå¤§äº†ã€‚
Vue3.0ä¹‹åä¸å†å°†ä¸»åŠ¨ç›‘å¬æ‰€æœ‰çš„æ•°æ®ï¼Œè€Œæ˜¯å°†é€‰æ‹©æƒç»™ä½ ï¼Œå®ä¾‹åœ¨åˆå§‹åŒ–æ—¶ä¸éœ€è¦å†å»é€’å½’ data å¯¹è±¡äº†ï¼Œ
ä»è€Œé™ä½äº†ç»„ä»¶å®ä¾‹åŒ–çš„æ—¶é—´ã€‚</li></ul> <p><strong>vue3 ref</strong></p> <ul><li><p>refæ¥æ”¶ä¸€ä¸ªåŸå§‹å€¼ï¼Œè¿”å›ä¸€ä¸ªåŒ…è£…å¯¹è±¡ï¼Œ
åŒ…è£…å¯¹è±¡å…·æœ‰.valueå±æ€§ã€‚é€šè¿‡.valueè®¿é—®è¿™ä¸ªå€¼ã€‚</p></li> <li><p>è¢« ref æ–¹æ³•åŒ…è£¹åçš„ å…ƒç´  å°±å˜æˆäº†ä¸€ä¸ªä»£ç†å¯¹è±¡ã€‚</p></li> <li><p>ä¸€èˆ¬è€Œè¨€ï¼Œè¿™é‡Œçš„å…ƒç´ å‚æ•°æŒ‡ åŸºæœ¬å…ƒç´  æˆ–è€…ç§°ä¹‹ä¸º inner valueï¼Œ
å¦‚ï¼šnumber, string, boolean,null,undefied ç­‰ï¼Œobject ä¸€èˆ¬ä¸ä½¿ç”¨ refï¼Œè€Œæ˜¯ä½¿ç”¨ä¸Šæ–‡çš„ reactiveã€‚
ä¹Ÿå°±æ˜¯è¯´ ref ä¸€èˆ¬é€‚ç”¨äºæŸä¸ªå…ƒç´ çš„ï¼›è€Œ reactive é€‚ç”¨äºä¸€ä¸ªå¯¹è±¡ã€‚
ref ä¹Ÿå°±ç›¸å½“äºæŠŠå•ä¸ªå…ƒç´ è½¬æ¢æˆä¸€ä¸ª reactive å¯¹è±¡äº†ï¼Œå¯¹è±¡é»˜è®¤çš„é”®å€¼åæ˜¯ï¼švalueã€‚
<strong>ref å’Œ reactiveåŒºåˆ«</strong></p></li> <li><p>å…¶å®refç›¸å½“äºreactiveçš„å°å¼Ÿï¼ŒrefèƒŒåä¹Ÿæ˜¯é€šè¿‡reactiveå®ç°çš„ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯refè¿”å›çš„æ˜¯åŒ…è£…å¯¹è±¡
const count = ref(0)  ç­‰ä»· const count = reactive({value:0})</p></li> <li><p>åœ¨setupå‡½æ•°ä¸­ï¼Œå¦‚æœé€šè¿‡ç»“æ„è¿”å›refå’Œreactive,é‚£ä¹ˆåœ¨æ¨¡æ¿æ¸²æŸ“ä¸Šä¸‹æ–‡ä¸­ï¼Œè·å–ä¸åˆ°ä»–ä»¬çš„å“åº”å¼å˜åŒ–ã€‚
å› ä¸ºè§£æ„ä»–ä»¬å°±æ„å‘³ç€copyäº†ä»–ä»¬çš„å¼•ç”¨ã€‚æ‰€ä»¥å°½é‡ä¸è¦ç”¨è§£æ„å»è¿”å›ä¸€ä¸ªä½ æœŸæœ›å“åº”å¼çš„æ•°æ®</p></li></ul> <p><strong>vue3 computed</strong></p> <ul><li>3.0ä¸­ï¼Œcomputed è¢«æŠ½æˆä¸€ä¸ªAPIï¼Œç›´æ¥ä»vueä¸­è·å–ï¼Œ
è€ŒVue2.xä¸­ï¼Œcomputedæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œåœ¨å¯¹è±¡ä¸­å®šä¹‰ä¸€ä¸ªä¸ªcomputed</li></ul> <p><strong>vue3 watch</strong></p> <ul><li><p>watch() API æä¾›äº†åŸºäºè§‚å¯ŸçŠ¶æ€çš„å˜åŒ–æ¥æ‰§è¡Œå‰¯ä½œç”¨çš„èƒ½åŠ›ã€‚</p></li> <li><p>watch(source,cb,options?)</p> <p>watch() æ¥æ”¶ä¸‰ä¸ªå‚æ•°</p> <div class="language- extra-class"><pre><code>  1.ç¬¬ä¸€ä¸ªå‚æ•°è¢«ç§°ä½œ â€œæ•°æ®æºâ€ï¼Œå®ƒå¯ä»¥æ˜¯ï¼š
  
      ä¸€ä¸ªè¿”å›ä»»æ„å€¼çš„å‡½æ•°
  	
      ä¸€ä¸ªåŒ…è£…å¯¹è±¡
  	
      ä¸€ä¸ªåŒ…å«ä¸Šè¿°ä¸¤ç§æ•°æ®æºçš„æ•°ç»„
  	
      sourceï¼šå¯ä»¥æ˜¯getterå‡½æ•°ï¼Œå€¼åŒ…è£…å™¨æˆ–åŒ…å«ä¸Šè¿°ä¸¤ç§ç±»å‹çš„æ•°ç»„ï¼ˆå¦‚æœè¦æŸ¥çœ‹å¤šä¸ªæºï¼‰
  	
  2.ç¬¬äºŒä¸ªå‚æ•°æ˜¯å›è°ƒå‡½æ•°ã€‚å›è°ƒå‡½æ•°åªæœ‰å½“æ•°æ®æºå‘ç”Ÿå˜åŠ¨æ—¶æ‰ä¼šè¢«è§¦å‘ï¼š
  
      callbackï¼šæ˜¯ç±»ä¼¼äºVue2 watcherå¤„ç†ç¨‹åºçš„å‡½æ•°ï¼Œå¸¦æœ‰2ä¸ªå‚æ•°ï¼šnewValï¼ŒoldValã€‚
  	
      æ¯ä¸ªå‚æ•°éƒ½å¯ä»¥æ˜¯ä¸€ä¸ªæ•°ç»„(ç”¨äºè§‚å¯Ÿå¤šä¸ªæº): [newVal1ï¼ŒnewVal2ï¼Œ... newValN]ï¼Œ[oldVal1ï¼ŒoldVal2ï¼Œ... oldValN]
  
  3.ç¬¬ä¸‰ä¸ªå¯é€‰å‚æ•°options,
  
      deep æ·±åº¦ç›‘å¬
  	
          ç±»å‹: boolean  default :false
          å’ŒVue2.xè¡Œä¸ºä¸€è‡´ï¼Œéƒ½æ˜¯å¯¹å¯¹è±¡çš„æ·±åº¦ç›‘å¬
  		
      Lazy - å’ŒVue2.x immediate æ­£å¥½ç›¸å
  	
          ç±»å‹:Boolean, default:false</code></pre></div></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/blog/koa1.html" class="prev">
        Koa
      </a></span> <span class="next"><a href="/blog/react.html">
        React ä½¿ç”¨
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a0896f0e.js" defer></script><script src="/assets/js/2.88eb2c00.js" defer></script><script src="/assets/js/31.ac601726.js" defer></script>
  </body>
</html>
