<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Node.js | 前端日志</title>
    <meta name="generator" content="VuePress 1.9.5">
    
    <meta name="description" content="欢迎访问我的前端日志">
    
    <link rel="preload" href="/assets/css/0.styles.e1700646.css" as="style"><link rel="preload" href="/assets/js/app.a0896f0e.js" as="script"><link rel="preload" href="/assets/js/2.88eb2c00.js" as="script"><link rel="preload" href="/assets/js/23.99088ae7.js" as="script"><link rel="prefetch" href="/assets/js/10.d30f3d8f.js"><link rel="prefetch" href="/assets/js/11.e2b957ff.js"><link rel="prefetch" href="/assets/js/12.2da1d6bb.js"><link rel="prefetch" href="/assets/js/13.8ce2c088.js"><link rel="prefetch" href="/assets/js/14.16109f84.js"><link rel="prefetch" href="/assets/js/15.93448cfb.js"><link rel="prefetch" href="/assets/js/16.6f18825f.js"><link rel="prefetch" href="/assets/js/17.be1e4a31.js"><link rel="prefetch" href="/assets/js/18.e635c0f4.js"><link rel="prefetch" href="/assets/js/19.be17ff30.js"><link rel="prefetch" href="/assets/js/20.d142b0c9.js"><link rel="prefetch" href="/assets/js/21.e40d6d09.js"><link rel="prefetch" href="/assets/js/22.071940ae.js"><link rel="prefetch" href="/assets/js/24.670dab57.js"><link rel="prefetch" href="/assets/js/25.85694927.js"><link rel="prefetch" href="/assets/js/26.461dcdb2.js"><link rel="prefetch" href="/assets/js/27.878ab7f9.js"><link rel="prefetch" href="/assets/js/28.1fcc3f4d.js"><link rel="prefetch" href="/assets/js/29.86923448.js"><link rel="prefetch" href="/assets/js/3.037aac60.js"><link rel="prefetch" href="/assets/js/30.724a5ac7.js"><link rel="prefetch" href="/assets/js/31.ac601726.js"><link rel="prefetch" href="/assets/js/32.765bf8d3.js"><link rel="prefetch" href="/assets/js/33.509ffbda.js"><link rel="prefetch" href="/assets/js/34.5aa96cf1.js"><link rel="prefetch" href="/assets/js/35.f1909c5d.js"><link rel="prefetch" href="/assets/js/36.36538350.js"><link rel="prefetch" href="/assets/js/37.b9375bb3.js"><link rel="prefetch" href="/assets/js/38.193abee5.js"><link rel="prefetch" href="/assets/js/39.b584d1b5.js"><link rel="prefetch" href="/assets/js/4.a0809240.js"><link rel="prefetch" href="/assets/js/40.17832949.js"><link rel="prefetch" href="/assets/js/41.cde349a4.js"><link rel="prefetch" href="/assets/js/42.67b16448.js"><link rel="prefetch" href="/assets/js/43.1b5d99f6.js"><link rel="prefetch" href="/assets/js/44.9ecb1424.js"><link rel="prefetch" href="/assets/js/5.77c6fbd3.js"><link rel="prefetch" href="/assets/js/6.609d5ed0.js"><link rel="prefetch" href="/assets/js/7.9131668e.js"><link rel="prefetch" href="/assets/js/8.f1d4a37a.js"><link rel="prefetch" href="/assets/js/9.8be87860.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e1700646.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">前端日志</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">
  博客
</a></div><div class="nav-item"><a href="/combat/" class="nav-link">
  实战
</a></div><div class="nav-item"><a href="/book/" class="nav-link">
  阅读
</a></div><div class="nav-item"><a href="https://github.com/wumao016" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">
  博客
</a></div><div class="nav-item"><a href="/combat/" class="nav-link">
  实战
</a></div><div class="nav-item"><a href="/book/" class="nav-link">
  阅读
</a></div><div class="nav-item"><a href="https://github.com/wumao016" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>DevOps</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/php.html" class="sidebar-link">工具的安装</a></li><li><a href="/blog/php1.html" class="sidebar-link">PHP</a></li><li><a href="/blog/node.html" aria-current="page" class="active sidebar-link">Node.js</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/node.html#node-js入门" class="sidebar-link">Node.js入门</a></li><li class="sidebar-sub-header"><a href="/blog/node.html#node-js-回调函数" class="sidebar-link">Node.js 回调函数</a></li><li class="sidebar-sub-header"><a href="/blog/node.html#node-js事件驱动机制" class="sidebar-link">Node.js事件驱动机制</a></li><li class="sidebar-sub-header"><a href="/blog/node.html#node-js模块化" class="sidebar-link">Node.js模块化</a></li><li class="sidebar-sub-header"><a href="/blog/node.html#node-js函数" class="sidebar-link">Node.js函数</a></li><li class="sidebar-sub-header"><a href="/blog/node.html#node-js路由" class="sidebar-link">Node.js路由</a></li><li class="sidebar-sub-header"><a href="/blog/node.html#node-js全局对象" class="sidebar-link">Node.js全局对象</a></li><li class="sidebar-sub-header"><a href="/blog/node.html#node-js-常用工具" class="sidebar-link">Node.js 常用工具</a></li><li class="sidebar-sub-header"><a href="/blog/node.html#node-js-文件系统" class="sidebar-link">Node.js 文件系统</a></li><li class="sidebar-sub-header"><a href="/blog/node.html#node-js-restful-api" class="sidebar-link">Node.js RESTful API</a></li><li class="sidebar-sub-header"><a href="/blog/node.html#node-js-web-模块" class="sidebar-link">Node.js Web 模块</a></li><li class="sidebar-sub-header"><a href="/blog/node.html#node-js-fs-模块" class="sidebar-link">Node.js fs 模块</a></li><li class="sidebar-sub-header"><a href="/blog/node.html#node-js-stream-模块" class="sidebar-link">Node.js stream 模块</a></li><li class="sidebar-sub-header"><a href="/blog/node.html#node-js-net-模块" class="sidebar-link">Node.js net 模块</a></li><li class="sidebar-sub-header"><a href="/blog/node.html#大规模nodejs项目架构与优化" class="sidebar-link">大规模NodeJS项目架构与优化</a></li><li class="sidebar-sub-header"><a href="/blog/node.html#爬虫以及robots协议介绍" class="sidebar-link">爬虫以及Robots协议介绍</a></li></ul></li><li><a href="/blog/webpack.html" class="sidebar-link">Webpack 使用</a></li><li><a href="/blog/gulp.html" class="sidebar-link">构建工具和脚手架</a></li><li><a href="/blog/optimization.html" class="sidebar-link">性能优化</a></li><li><a href="/blog/nginx.html" class="sidebar-link">Nginx</a></li><li><a href="/blog/engineering.html" class="sidebar-link">前端工程化</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Framework</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/express.html" class="sidebar-link">Express</a></li><li><a href="/blog/koa1.html" class="sidebar-link">Koa</a></li><li><a href="/blog/vue.html" class="sidebar-link">VUE 源码</a></li><li><a href="/blog/react.html" class="sidebar-link">React 使用</a></li><li><a href="/blog/uniapp.html" class="sidebar-link">Uni-app使用</a></li><li><a href="/blog/ts.html" class="sidebar-link">TS 使用</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>CSS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/css-3d.html" class="sidebar-link">CSS使用</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/es5.html" class="sidebar-link">ES5.1</a></li><li><a href="/blog/es6.html" class="sidebar-link">ES6</a></li><li><a href="/blog/javascript-QA.html" class="sidebar-link">Javascript与QA工程师</a></li><li><a href="/blog/js.html" class="sidebar-link">JavaScript 精粹</a></li><li><a href="/blog/js-function.html" class="sidebar-link">函数式编程</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>其它</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/html.html" class="sidebar-link">同源和跨域</a></li><li><a href="/blog/http.html" class="sidebar-link">HTTP</a></li><li><a href="/blog/write.html" class="sidebar-link">手写函数</a></li><li><a href="/blog/test.html" class="sidebar-link">习题总结</a></li><li><a href="/blog/arithmetic.html" class="sidebar-link">算法</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="node-js"><a href="#node-js" class="header-anchor">#</a> Node.js</h1> <h2 id="node-js入门"><a href="#node-js入门" class="header-anchor">#</a> Node.js入门</h2> <p><strong>什么是Node.js?</strong></p> <ul><li>Node.js的本质是一个JavaScript的解析器</li> <li>Node.js是JavaScript的运行环境</li> <li>Node.js是一个服务器程序</li> <li>Node.js本身使用的是V8引擎</li> <li>Node不是Web服务器</li></ul> <p><strong>为什么要使用Node.js?</strong></p> <ul><li>为了提供高性能的web服务</li> <li>IO性能强大</li> <li>事件处理机制完善</li> <li>天然能够处理DOM</li> <li>社区活跃，生态圈日趋完善</li></ul> <p><strong>Node.js的优势</strong></p> <ul><li>处理大流量数据</li> <li>适合实时交互的应用</li> <li>完善支持对象数据库</li> <li>异步处理大量并发连接</li></ul> <p>写一个例子，在node环境下，如何连接服务器。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> http<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">//定义http头</span>
	res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'Content-Type'</span><span class="token operator">:</span><span class="token string">'text/plan'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token comment">//发送相应数据</span>
	res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'hello world'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8000</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>nodejs就是提供了一个js运行的环境，就好像充当浏览器的角色，为js代码提供解析。</p> <p><strong>Node.js REPL环境</strong></p> <p>在终端输入 node 就进入node的环境</p> <ul><li>ctrl+c 退出当前终端</li> <li>ctrl+c 两下 退出node REPL</li> <li>ctrl+d 退出node REPL（linux）</li> <li>上/下键 查看输入的历史命令</li> <li>tab 列出当前命令</li> <li>.help 列出使用命令</li> <li>.break 退出多行表达式</li> <li>.clear 退出多行表达式</li> <li>.save filename 保存当前的node REPL会话到指定文件</li> <li>.load filename 载入当前的node REPL会话到指定文件
<strong>npm 命令</strong></li> <li>npm install npm -g 更新npm</li> <li>npm install ** -g 全局安装</li> <li>npm install ** 本地安装</li> <li>npm uninstall ** 删除</li> <li>npm search ** 查找</li> <li>npm help 帮助</li></ul> <h2 id="node-js-回调函数"><a href="#node-js-回调函数" class="header-anchor">#</a> Node.js 回调函数</h2> <h3 id="什么是回调"><a href="#什么是回调" class="header-anchor">#</a> 什么是回调</h3> <p>函数调用方式分为三类：同步调用、回调和异步调用。回调是一种双向调用模式，可以通过回调函数来实现回调。</p> <h3 id="阻塞与非阻塞"><a href="#阻塞与非阻塞" class="header-anchor">#</a> 阻塞与非阻塞</h3> <p>要了解回调函数什么时候使用，就要先了解一下阻塞与非阻塞。</p> <p>阻塞与非阻塞关注的是程序在等待调用结果时的状态，阻塞是要等程序做完，而非阻塞是可以先做其他事，执行完后会通知当前函数。</p> <p>通过代码比较一下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//阻塞代码 例如读取一个文件，在读取完这个文件之前，是不能有其他操作的，这就形成了阻塞</span>
<span class="token keyword">var</span> fs<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> data<span class="token operator">=</span>fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'data.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//readFileSync同步读取</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//非阻塞代码</span>
<span class="token keyword">var</span> fs<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'data.txt'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'程序执行完毕'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//执行的顺序是不必等待前面的，先执行后面执行完毕，再打出数据</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>这两段代码，就能看出阻塞与非阻塞的区别，非阻塞就是通过匿名函数实现了回调。这就是回调的使用。</p> <h2 id="node-js事件驱动机制"><a href="#node-js事件驱动机制" class="header-anchor">#</a> Node.js事件驱动机制</h2> <p>Node.js事件驱动机制在nodejs编程过程中是比较重要的一个环节。先简单的了解两点，事件驱动模型，事件与事件的绑定。</p> <p>要了解nodejs驱动模型，首先要知道nodejs的运行机制，nodejs是一个单进程单线程的程序，也就是说它不能同时并发的完成更多的事情，而通过事件或回调来实现并发的这种效果。正因为它没有多线程那样额外的工作，所有它的性能是比较高。</p> <p>第二点，nodejs当中每一个API都支持回调函数，而且都是属于独立的线程来运行的。而使用异步函数调用，我们就可以使用这种机制来进行并发处理。</p> <p>nodejs中几乎所有事件机制都是依据观察者模式实现的，而观察者模式是设计模式的一种。</p> <p>事件驱动模型图解
<img src="node_1.png" alt="node事件驱动模型"></p> <h3 id="事件处理代码流程"><a href="#事件处理代码流程" class="header-anchor">#</a> 事件处理代码流程</h3> <ul><li>引入events对象，创建eventEmitter对象</li> <li>绑定事件处理程序</li> <li>触发事件</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//引入events对象，创建eventEmitter对象</span>
<span class="token keyword">var</span> events<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'events'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> eventEmitter<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">events<span class="token punctuation">.</span>EventEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment">//绑定事件处理程序</span>
<span class="token keyword">var</span> <span class="token function-variable function">connctHandler</span><span class="token operator">=</span><span class="token keyword">function</span> <span class="token function">connected</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'connected被调用'</span><span class="token punctuation">)</span>；
<span class="token punctuation">}</span>
eventEmitter<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'connection'</span><span class="token punctuation">,</span><span class="token function">connctHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//完成事件绑定</span>
<span class="token comment">//触发事件</span>
eventEmitter<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'connection'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="node-js模块化"><a href="#node-js模块化" class="header-anchor">#</a> Node.js模块化</h2> <h3 id="模块化的概念与意义"><a href="#模块化的概念与意义" class="header-anchor">#</a> 模块化的概念与意义</h3> <ul><li>为了让Node.js的文件可以相互调用Node.js提供了一个简单的模块系统</li> <li>模块是Node.js应用程序的基本组成部分</li> <li>文件和模块是一一对应的。一个Node.js文件就是一个模块</li> <li>这个文件可能是JavaScript代码，JSON或者编译过的C/C++扩展</li> <li>Node.js中存在4类模块（原生和3种文件模块）</li></ul> <h3 id="node-js的模块加载流程"><a href="#node-js的模块加载流程" class="header-anchor">#</a> Node.js的模块加载流程</h3> <p><img src="node.png" alt="模块流程"></p> <h3 id="node-js的模块加载方式"><a href="#node-js的模块加载方式" class="header-anchor">#</a> Node.js的模块加载方式</h3> <ul><li>从文件模块缓存中加载</li> <li>从原生模块加载</li> <li>从文件加载</li></ul> <p><code>require方法加载模块</code></p> <ul><li>require方法接受以下几种参数的传递：</li> <li>http fs path等，原生模块</li> <li>./mod或../mod，相对路径的文件模块。</li> <li>/pathtomodule/mod,绝对路径的文件模块</li> <li>mod，非原生模块的文件模块。</li></ul> <p><strong>代码示范</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//模块</span>
<span class="token keyword">function</span> <span class="token function">Hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">//具体操作</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span>Hello<span class="token punctuation">;</span>

<span class="token comment">//另一个要调用hello模块中</span>
<span class="token keyword">var</span> Hello<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
hello<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="node-js函数"><a href="#node-js函数" class="header-anchor">#</a> Node.js函数</h2> <h3 id="函数概念"><a href="#函数概念" class="header-anchor">#</a> 函数概念</h3> <ul><li>在JavaScript中，一个函数可以作为另一个函数的参数</li> <li>我们可以定义一个函数，然后传递，也可以在传递参数的地方直接定义函数（匿名函数）</li> <li>Node.js中函数的使用与JavaScript类似</li></ul> <h3 id="匿名函数"><a href="#匿名函数" class="header-anchor">#</a> 匿名函数</h3> <ul><li>我们可以把一个函数作为变量传递</li> <li>不一定“先定义，再传递”，可以用直接在另一个函数的括号中定义和传递这个函数</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">ex</span><span class="token punctuation">(</span><span class="token parameter">someFunction<span class="token punctuation">,</span>value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token function">someFunction</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">ex</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">word</span><span class="token punctuation">)</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>word<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="node-js路由"><a href="#node-js路由" class="header-anchor">#</a> Node.js路由</h2> <p>我们要为路由提供请求的 URL 和其他需要的 GET 及 POST 参数，随后路由需要根据这些数据来执行相应的代码。</p> <p>因此，我们需要查看 HTTP 请求，从中提取出请求的 URL 以及 GET/POST 参数。这一功能应当属于路由还是服务器（甚至作为一个模块自身的功能）确实值得探讨，但这里暂定其为我们的HTTP服务器的功能。</p> <p>我们需要的所有数据都会包含在 request 对象中，该对象作为 onRequest() 回调函数的第一个参数传递。但是为了解析这些数据，我们需要额外的 Node.JS 模块，它们分别是 url 和 querystring 模块。
<img src="noderouter.png" alt="node路由"> <strong>写一个服务器搭使用路由模块的例子</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//server.js</span>
<span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;url&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token keyword">function</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token parameter">route</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">onRequest</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> pathname <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>pathname<span class="token punctuation">;</span>
    <span class="token function">route</span><span class="token punctuation">(</span>pathname<span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>  
  <span class="token punctuation">}</span>
 
  http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span>onRequest<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8888</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Server has started.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
 
exports<span class="token punctuation">.</span>start <span class="token operator">=</span> start<span class="token punctuation">;</span>
<span class="token comment">//router.js</span>
<span class="token keyword">function</span> <span class="token function">route</span><span class="token punctuation">(</span><span class="token parameter">pathname<span class="token punctuation">,</span>response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>pathname<span class="token operator">==</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		response<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">&quot;Content-Type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;text/plain&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		response<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>pathname<span class="token operator">==</span><span class="token string">&quot;/index/home&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
		response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'404'</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
 
exports<span class="token punctuation">.</span>route <span class="token operator">=</span> route<span class="token punctuation">;</span>
<span class="token comment">//index.js</span>
<span class="token keyword">var</span> server <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./server&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./router&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span>route<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h3 id="node-js-get-post请求"><a href="#node-js-get-post请求" class="header-anchor">#</a> Node.js GET/POST请求</h3> <p>在很多场景中，我们的服务器都需要跟用户的浏览器打交道，如表单提交。</p> <p>表单提交到服务器一般都使用 GET/POST 请求。</p> <p>本章节我们将为大家介绍 Node.js GET/POST请求。</p> <p><strong>获取GET请求内容</strong></p> <p>由于GET请求直接被嵌入在路径中，URL是完整的请求路径，包括了?后面的部分，因此你可以手动解析后面的内容作为GET请求的参数。</p> <p>node.js 中 url 模块中的 parse 函数提供了这个功能。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> util <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'util'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'text/plain; charset=utf-8'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>util<span class="token punctuation">.</span><span class="token function">inspect</span><span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>在浏览器中访问 http://localhost:3000/user?name=菜鸟教程&amp;url=www.runoob.com 然后查看返回结果:
<img src="nodeget.png" alt="get请求"></p> <p><strong>获取 POST 请求内容</strong></p> <p>POST 请求的内容全部的都在请求体中，http.ServerRequest 并没有一个属性内容为请求体，原因是等待请求体传输可能是一件耗时的工作。</p> <p>比如上传文件，而很多时候我们可能并不需要理会请求体的内容，恶意的POST请求会大大消耗服务器的资源，所以 node.js 默认是不会解析请求体的，当你需要的时候，需要手动来做。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> querystring <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'querystring'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token keyword">var</span> postHTML <span class="token operator">=</span> 
  <span class="token string">'&lt;html&gt;&lt;head&gt;&lt;meta charset=&quot;utf-8&quot;&gt;&lt;title&gt;菜鸟教程 Node.js 实例&lt;/title&gt;&lt;/head&gt;'</span> <span class="token operator">+</span>
  <span class="token string">'&lt;body&gt;'</span> <span class="token operator">+</span>
  <span class="token string">'&lt;form method=&quot;post&quot;&gt;'</span> <span class="token operator">+</span>
  <span class="token string">'网站名： &lt;input name=&quot;name&quot;&gt;&lt;br&gt;'</span> <span class="token operator">+</span>
  <span class="token string">'网站 URL： &lt;input name=&quot;url&quot;&gt;&lt;br&gt;'</span> <span class="token operator">+</span>
  <span class="token string">'&lt;input type=&quot;submit&quot;&gt;'</span> <span class="token operator">+</span>
  <span class="token string">'&lt;/form&gt;'</span> <span class="token operator">+</span>
  <span class="token string">'&lt;/body&gt;&lt;/html&gt;'</span><span class="token punctuation">;</span>
 
http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> body <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
  req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    body <span class="token operator">+=</span> chunk<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 解析参数</span>
    body <span class="token operator">=</span> querystring<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 设置响应头部信息及编码</span>
    res<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'text/html; charset=utf8'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token keyword">if</span><span class="token punctuation">(</span>body<span class="token punctuation">.</span>name <span class="token operator">&amp;&amp;</span> body<span class="token punctuation">.</span>url<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 输出提交的数据</span>
        res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;网站名：&quot;</span> <span class="token operator">+</span> body<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;br&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;网站 URL：&quot;</span> <span class="token operator">+</span> body<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>  <span class="token comment">// 输出表单</span>
        res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>postHTML<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h2 id="node-js全局对象"><a href="#node-js全局对象" class="header-anchor">#</a> Node.js全局对象</h2> <p>JavaScript 中有一个特殊的对象，称为全局对象（Global Object），它及其所有属性都可以在程序的任何地方访问，即全局变量。</p> <p>在浏览器 JavaScript 中，通常 window 是全局对象， 而 Node.js 中的全局对象是 global，所有全局变量（除了 global 本身以外）都是 global 对象的属性。</p> <p>在 Node.js 我们可以直接访问到 global 的属性，而不需要在应用中包含它。</p> <h3 id="全局对象与全局变量"><a href="#全局对象与全局变量" class="header-anchor">#</a> 全局对象与全局变量</h3> <p>global 最根本的作用是作为全局变量的宿主。按照 ECMAScript 的定义，满足以下条 件的变量是全局变量：</p> <ul><li>在最外层定义的变量；</li> <li>全局对象的属性；</li> <li>隐式定义的变量（未定义直接赋值的变量）。</li></ul> <p>当你定义一个全局变量时，这个变量同时也会成为全局对象的属性，反之亦然。需要注 意的是，在 Node.js 中你不可能在最外层定义变量，因为所有用户代码都是属于当前模块的， 而模块本身不是最外层上下文。</p> <p><strong>注意：</strong> 最好不要使用 var 定义变量以避免引入全局变量，因为全局变量会污染命名空间，提高代码的耦合风险。</p> <h3 id="filename"><a href="#filename" class="header-anchor">#</a> __filename</h3> <p>__filename 表示当前正在执行的脚本的文件名。它将输出文件所在位置的绝对路径，且和命令行参数所指定的文件名不一定相同。 如果在模块中，返回的值是模块文件的路径。</p> <h3 id="dirname"><a href="#dirname" class="header-anchor">#</a> __dirname</h3> <p>__dirname 表示当前执行脚本所在的目录。</p> <h3 id="settimeout-cb-ms"><a href="#settimeout-cb-ms" class="header-anchor">#</a> setTimeout(cb, ms)</h3> <p>setTimeout(cb, ms) 全局函数在指定的毫秒(ms)数后执行指定函数(cb)。：setTimeout() 只执行一次指定函数。</p> <p>返回一个代表定时器的句柄值。</p> <h3 id="cleartimeout-t"><a href="#cleartimeout-t" class="header-anchor">#</a> clearTimeout(t)</h3> <p>clearTimeout( t ) 全局函数用于停止一个之前通过 setTimeout() 创建的定时器。 参数 t 是通过 setTimeout() 函数创建的定时器。</p> <h3 id="setinterval-cb-ms"><a href="#setinterval-cb-ms" class="header-anchor">#</a> setInterval(cb, ms)</h3> <p>setInterval(cb, ms) 全局函数在指定的毫秒(ms)数后执行指定函数(cb)。</p> <p>返回一个代表定时器的句柄值。可以使用 clearInterval(t) 函数来清除定时器。</p> <p>setInterval() 方法会不停地调用函数，直到 clearInterval() 被调用或窗口被关闭。</p> <h3 id="console"><a href="#console" class="header-anchor">#</a> console</h3> <p>console 用于提供控制台标准输出，它是由 Internet Explorer 的 JScript 引擎提供的调试工具，后来逐渐成为浏览器的实施标准。</p> <p>Node.js 沿用了这个标准，提供与习惯行为一致的 console 对象，用于向标准输出流（stdout）或标准错误流（stderr）输出字符。</p> <h3 id="process"><a href="#process" class="header-anchor">#</a> process</h3> <p>process 是一个全局变量，即 global 对象的属性。</p> <p>它用于描述当前Node.js 进程状态的对象，提供了一个与操作系统的简单接口。通常在你写本地命令行程序的时候，少不了要 和它打交道。下面将会介绍 process 对象的一些最常用的成员方法。</p> <table><thead><tr><th>序号</th> <th>方法 &amp; 描述</th></tr></thead> <tbody><tr><td>1</td> <td>exit 当进程准备退出时触发。</td></tr> <tr><td>2</td> <td>beforeExit 当 node 清空事件循环，并且没有其他安排时触发这个事件。通常来说，当没有进程安排时 node 退出，但是 'beforeExit' 的监听器可以异步调用，这样 node 就会继续执行。</td></tr> <tr><td>3</td> <td>uncaughtException 当一个异常冒泡回到事件循环，触发这个事件。如果给异常添加了监视器，默认的操作（打印堆栈跟踪信息并退出）就不会发生。</td></tr> <tr><td>4</td> <td>Signal 事件 当进程接收到信号时就触发。信号列表详见标准的 POSIX 信号名，如 SIGINT、SIGUSR1 等。</td></tr></tbody></table> <h2 id="node-js-常用工具"><a href="#node-js-常用工具" class="header-anchor">#</a> Node.js 常用工具</h2> <p>util 是一个Node.js 核心模块，提供常用函数的集合，用于弥补核心 JavaScript 的功能 过于精简的不足。</p> <h3 id="util-callbackify"><a href="#util-callbackify" class="header-anchor">#</a> util.callbackify</h3> <p>util.callbackify(original) 将 async 异步函数（或者一个返回值为 Promise 的函数）转换成遵循异常优先的回调风格的函数，例如将 (err, value) =&gt; ... 回调作为最后一个参数。 在回调函数中，第一个参数为拒绝的原因（如果 Promise 解决，则为 null），第二个参数则是解决的值。</p> <h3 id="util-inherits"><a href="#util-inherits" class="header-anchor">#</a> util.inherits</h3> <p>util.inherits(constructor, superConstructor) 是一个实现对象间原型继承的函数。</p> <p>JavaScript 的面向对象特性是基于原型的，与常见的基于类的不同。JavaScript 没有提供对象继承的语言级别特性，而是通过原型复制来实现的。</p> <h3 id="util-inspect"><a href="#util-inspect" class="header-anchor">#</a> util.inspect</h3> <p>util.inspect(object,[showHidden],[depth],[colors]) 是一个将任意对象转换 为字符串的方法，通常用于调试和错误输出。它至少接受一个参数 object，即要转换的对象。</p> <p>showHidden 是一个可选参数，如果值为 true，将会输出更多隐藏信息。</p> <p>depth 表示最大递归的层数，如果对象很复杂，你可以指定层数以控制输出信息的多 少。如果不指定depth，默认会递归 2 层，指定为 null 表示将不限递归层数完整遍历对象。 如果 colors 值为 true，输出格式将会以 ANSI 颜色编码，通常用于在终端显示更漂亮 的效果。</p> <p>特别要指出的是，util.inspect 并不会简单地直接把对象转换为字符串，即使该对 象定义了 toString 方法也不会调用。</p> <h3 id="util-isarray-object"><a href="#util-isarray-object" class="header-anchor">#</a> util.isArray(object)</h3> <p>如果给定的参数 &quot;object&quot; 是一个数组返回 true，否则返回 false。</p> <h3 id="util-isregexp-object"><a href="#util-isregexp-object" class="header-anchor">#</a> util.isRegExp(object)</h3> <p>如果给定的参数 &quot;object&quot; 是一个正则表达式返回true，否则返回false。</p> <h3 id="util-isdate-object"><a href="#util-isdate-object" class="header-anchor">#</a> util.isDate(object)</h3> <p>如果给定的参数 &quot;object&quot; 是一个日期返回true，否则返回false。</p> <h3 id="除了util-还有underscore-js比util更全面"><a href="#除了util-还有underscore-js比util更全面" class="header-anchor">#</a> 除了util，还有underscore.js比util更全面</h3> <h2 id="node-js-文件系统"><a href="#node-js-文件系统" class="header-anchor">#</a> Node.js 文件系统</h2> <p>Node.js 提供一组类似 UNIX（POSIX）标准的文件操作API。 Node 导入文件系统模块(fs)语法如下所示：<code>var fs = require(&quot;fs&quot;)</code></p> <h3 id="异步和同步"><a href="#异步和同步" class="header-anchor">#</a> 异步和同步</h3> <p>Node.js 文件系统（fs 模块）模块中的方法均有异步和同步版本，例如读取文件内容的函数有异步的 fs.readFile() 和同步的 fs.readFileSync()。</p> <p>异步的方法函数最后一个参数为回调函数，回调函数的第一个参数包含了错误信息(error)。</p> <p>建议大家使用异步方法，比起同步，异步方法性能更高，速度更快，而且没有阻塞。</p> <h3 id="打开文件"><a href="#打开文件" class="header-anchor">#</a> 打开文件</h3> <p><strong>语法</strong></p> <p>以下为在异步模式下打开文件的语法格式：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>fs<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> flags<span class="token punctuation">[</span><span class="token punctuation">,</span> mode<span class="token punctuation">]</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>参数</strong></p> <p>参数使用说明如下：</p> <ul><li>path - 文件的路径。</li> <li>flags - 文件打开的行为。具体值详见下文。</li> <li>mode - 设置文件模式(权限)，文件创建默认权限为 0666(可读，可写)。</li> <li>callback - 回调函数，带有两个参数如：callback(err, fd)。</li></ul> <p>flags 参数可以是以下值：</p> <table><thead><tr><th>Flag</th> <th>描述</th></tr></thead> <tbody><tr><td>r</td> <td>以读取模式打开文件。如果文件不存在抛出异常。</td></tr> <tr><td>r+</td> <td>以读写模式打开文件。如果文件不存在抛出异常。</td></tr> <tr><td>rs</td> <td>以同步的方式读取文件。</td></tr> <tr><td>rs+</td> <td>以同步的方式读取和写入文件。</td></tr> <tr><td>w</td> <td>以写入模式打开文件，如果文件不存在则创建。</td></tr> <tr><td>wx</td> <td>类似 'w'，但是如果文件路径存在，则文件写入失败。</td></tr> <tr><td>w+</td> <td>以读写模式打开文件，如果文件不存在则创建。</td></tr> <tr><td>wx+</td> <td>类似 'w+'， 但是如果文件路径存在，则文件读写失败。</td></tr> <tr><td>a</td> <td>以追加模式打开文件，如果文件不存在则创建。</td></tr> <tr><td>ax</td> <td>类似 'a'， 但是如果文件路径存在，则文件追加失败。</td></tr> <tr><td>a+</td> <td>以读取追加模式打开文件，如果文件不存在则创建。</td></tr> <tr><td>ax+</td> <td>类似 'a+'， 但是如果文件路径存在，则文件读取追加失败。</td></tr></tbody></table> <p>我们创建 file.js 文件，并打开 input.txt 文件进行读写，代码如下所示：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 异步打开文件</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;准备打开文件！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fs<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'input.txt'</span><span class="token punctuation">,</span> <span class="token string">'r+'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> fd</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;文件打开成功！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="获取文件信息"><a href="#获取文件信息" class="header-anchor">#</a> 获取文件信息</h3> <p><strong>语法</strong></p> <p>以下为通过异步模式获取文件信息的语法格式：fs.stat(path, callback)</p> <p><strong>参数</strong></p> <p>参数使用说明如下：</p> <ul><li>path - 文件路径。</li> <li>callback - 回调函数，带有两个参数如：(err, stats), stats 是 fs.Stats 对象。
fs.stat(path)执行后，会将stats类的实例返回给其回调函数。可以通过stats类中的提供方法判断文件的相关属性。</li></ul> <p>stats类中的方法有：</p> <table><thead><tr><th>方法</th> <th>描述</th></tr></thead> <tbody><tr><td>stats.isFile()</td> <td>如果是文件返回 true，否则返回 false。</td></tr> <tr><td>stats.isDirectory()</td> <td>如果是目录返回 true，否则返回 false。</td></tr> <tr><td>stats.isBlockDevice()</td> <td>如果是块设备返回 true，否则返回 false。</td></tr> <tr><td>stats.isCharacterDevice()</td> <td>如果是字符设备返回 true，否则返回 false。</td></tr> <tr><td>stats.isSymbolicLink()</td> <td>如果是软链接返回 true，否则返回 false。</td></tr> <tr><td>stats.isFIFO()</td> <td>如果是FIFO，返回true，否则返回 false。FIFO是UNIX中的一种特殊类型的命令管道。</td></tr> <tr><td>stats.isSocket()</td> <td>如果是 Socket 返回 true，否则返回 false。</td></tr></tbody></table> <h3 id="写入文件"><a href="#写入文件" class="header-anchor">#</a> 写入文件</h3> <p><strong>语法</strong></p> <p>以下为异步模式下写入文件的语法格式：fs.writeFile(file, data[, options], callback)</p> <p>writeFile 直接打开文件默认是 w 模式，所以如果文件存在，该方法写入的内容会覆盖旧的文件内容。</p> <p><strong>参数</strong></p> <p>参数使用说明如下：</p> <ul><li>file - 文件名或文件描述符。</li> <li>data - 要写入文件的数据，可以是 String(字符串) 或 Buffer(缓冲) 对象。</li> <li>options - 该参数是一个对象，包含 {encoding, mode, flag}。默认编码为 utf8, 模式为 0666 ， flag 为 'w'</li> <li>callback - 回调函数，回调函数只包含错误信息参数(err)，在写入失败时返回。</li></ul> <h3 id="读取文件"><a href="#读取文件" class="header-anchor">#</a> 读取文件</h3> <p><strong>语法</strong></p> <p>以下为异步模式下读取文件的语法格式：fs.read(fd, buffer, offset, length, position, callback)</p> <p>该方法使用了文件描述符来读取文件。</p> <p><strong>参数</strong></p> <p>参数使用说明如下：</p> <ul><li>fd - 通过 fs.open() 方法返回的文件描述符。</li> <li>buffer - 数据写入的缓冲区。</li> <li>offset - 缓冲区写入的写入偏移量。</li> <li>length - 要从文件中读取的字节数。</li> <li>position - 文件读取的起始位置，如果 position 的值为 null，则会从当前文件指针的位置读取。</li> <li>callback - 回调函数，有三个参数err, bytesRead, buffer，err 为错误信息， bytesRead 表示读取的字节数，buffer 为缓冲区对象。</li></ul> <h3 id="关闭文件"><a href="#关闭文件" class="header-anchor">#</a> 关闭文件</h3> <p><strong>语法</strong></p> <p>以下为异步模式下关闭文件的语法格式：fs.close(fd, callback)</p> <p>该方法使用了文件描述符来读取文件。</p> <p><strong>参数</strong></p> <p>参数使用说明如下：</p> <ul><li>fd - 通过 fs.open() 方法返回的文件描述符。</li> <li>callback - 回调函数，没有参数</li></ul> <h3 id="截取文件"><a href="#截取文件" class="header-anchor">#</a> 截取文件</h3> <p><strong>语法</strong></p> <p>以下为异步模式下截取文件的语法格式：fs.ftruncate(fd, len, callback)</p> <p>该方法使用了文件描述符来读取文件。</p> <p><strong>参数</strong></p> <p>参数使用说明如下：</p> <ul><li>fd - 通过 fs.open() 方法返回的文件描述符。</li> <li>len - 文件内容截取的长度。</li> <li>callback - 回调函数，没有参数。</li></ul> <h3 id="删除文件"><a href="#删除文件" class="header-anchor">#</a> 删除文件</h3> <p><strong>语法</strong></p> <p>以下为删除文件的语法格式：fs.unlink(path, callback)</p> <p><strong>参数</strong></p> <p>参数使用说明如下：</p> <ul><li>path - 文件路径。</li> <li>callback - 回调函数，没有参数。</li></ul> <h3 id="创建目录"><a href="#创建目录" class="header-anchor">#</a> 创建目录</h3> <p><strong>语法</strong></p> <p>以下为创建目录的语法格式：fs.mkdir(path[, options], callback)</p> <p><strong>参数</strong></p> <p>参数使用说明如下：</p> <ul><li>path - 文件路径。</li> <li>options 参数可以是：
<ul><li>recursive - 是否以递归的方式创建目录，默认为 false。</li> <li>mode - 设置目录权限，默认为 0777。</li></ul></li> <li>callback - 回调函数，没有参数。</li></ul> <h3 id="读取目录"><a href="#读取目录" class="header-anchor">#</a> 读取目录</h3> <p><strong>语法</strong></p> <p>以下为读取目录的语法格式：fs.readdir(path, callback)</p> <p><strong>参数</strong></p> <p>参数使用说明如下：</p> <ul><li>path - 文件路径。</li> <li>callback - 回调函数，回调函数带有两个参数err, files，err 为错误信息，files 为 目录下的文件数组列表。</li></ul> <h3 id="删除目录"><a href="#删除目录" class="header-anchor">#</a> 删除目录</h3> <p><strong>语法</strong></p> <p>以下为删除目录的语法格式：fs.rmdir(path, callback)</p> <p><strong>参数</strong></p> <p>参数使用说明如下：</p> <ul><li>path - 文件路径。</li> <li>callback - 回调函数，没有参数。</li></ul> <h2 id="node-js-restful-api"><a href="#node-js-restful-api" class="header-anchor">#</a> Node.js RESTful API</h2> <p>REST即表述性状态传递（英文：Representational State Transfer，简称REST）是Roy Fielding博士在2000年他的博士论文中提出来的一种软件架构风格。</p> <p>表述性状态转移是一组架构约束条件和原则。满足这些约束条件和原则的应用程序或设计就是RESTful。需要注意的是，REST是设计风格而不是标准。REST通常基于使用HTTP，URI，和XML（标准通用标记语言下的一个子集）以及HTML（标准通用标记语言下的一个应用）这些现有的广泛流行的协议和标准。REST 通常使用 JSON 数据格式。</p> <p><strong>HTTP 方法</strong></p> <p>以下为 REST 基本架构的四个方法：</p> <ul><li><p>GET - 用于获取数据。</p></li> <li><p>PUT - 用于更新或添加数据。</p></li> <li><p>DELETE - 用于删除数据。</p></li> <li><p>POST - 用于添加数据。</p></li></ul> <h2 id="node-js-web-模块"><a href="#node-js-web-模块" class="header-anchor">#</a> Node.js Web 模块</h2> <h3 id="什么是-web-服务器"><a href="#什么是-web-服务器" class="header-anchor">#</a> 什么是 Web 服务器？</h3> <p>Web服务器一般指网站服务器，是指驻留于因特网上某种类型计算机的程序，Web服务器的基本功能就是提供Web信息浏览服务。它只需支持HTTP协议、HTML文档格式及URL，与客户端的网络浏览器配合。</p> <p>大多数 web 服务器都支持服务端的脚本语言（php、python、ruby）等，并通过脚本语言从数据库获取数据，将结果返回给客户端浏览器。</p> <p>目前最主流的三个Web服务器是Apache、Nginx、IIS。</p> <p><img src="node_2.png" alt="Web 应用架构"></p> <ul><li><p><strong>Client</strong> - 客户端，一般指浏览器，浏览器可以通过 HTTP 协议向服务器请求数据。</p></li> <li><p><strong>Server</strong> - 服务端，一般指 Web 服务器，可以接收客户端请求，并向客户端发送响应数据。</p></li> <li><p><strong>Business</strong> - 业务层， 通过 Web 服务器处理应用程序，如与数据库交互，逻辑运算，调用外部程序等。</p></li> <li><p><strong>Data</strong> - 数据层，一般由数据库组成。</p></li></ul> <h3 id="使用-node-创建-web-服务器"><a href="#使用-node-创建-web-服务器" class="header-anchor">#</a> 使用 Node 创建 Web 服务器</h3> <p>Node.js 提供了 http 模块，http 模块主要用于搭建 HTTP 服务端和客户端，使用 HTTP 服务器或客户端功能必须调用 http 模块，代码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>以下是演示一个最基本的 HTTP 服务器架构(使用 8080 端口)，创建 server.js 文件，代码如下所示：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'url'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">// 创建服务器</span>
http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
   <span class="token comment">// 解析请求，包括文件名</span>
   <span class="token keyword">var</span> pathname <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>pathname<span class="token punctuation">;</span>
   
   <span class="token comment">// 输出请求的文件名</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Request for &quot;</span> <span class="token operator">+</span> pathname <span class="token operator">+</span> <span class="token string">&quot; received.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   
   <span class="token comment">// 从文件系统中读取请求的文件内容</span>
   fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>pathname<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">// HTTP 状态码: 404 : NOT FOUND</span>
         <span class="token comment">// Content Type: text/html</span>
         response<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'text/html'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>             
         <span class="token comment">// HTTP 状态码: 200 : OK</span>
         <span class="token comment">// Content Type: text/html</span>
         response<span class="token punctuation">.</span><span class="token function">writeHead</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'text/html'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
         
         <span class="token comment">// 响应文件内容</span>
         response<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        
      <span class="token punctuation">}</span>
      <span class="token comment">//  发送响应数据</span>
      response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 控制台会输出以下信息</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Server running at http://127.0.0.1:8080/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>接下来我们在该目录下创建一个 index.html 文件，代码如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">&quot;utf-8&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>title<span class="token operator">&gt;</span><span class="token function">菜鸟教程</span><span class="token punctuation">(</span>runoob<span class="token punctuation">.</span>com<span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>我的第一个标题<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>我的第一个段落。<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>执行 server.js 文件：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>$ node server<span class="token punctuation">.</span>js
Server running at http<span class="token operator">:</span><span class="token operator">/</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">127.0.0.1:8080</span><span class="token regex-delimiter">/</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>接着我们在浏览器中打开地址：http://127.0.0.1:8080/index.html.会显示相应页面。</p> <h3 id="使用-node-创建-web-客户端"><a href="#使用-node-创建-web-客户端" class="header-anchor">#</a> 使用 Node 创建 Web 客户端</h3> <p>Node 创建 Web 客户端需要引入 http 模块，创建 client.js 文件，代码如下所示：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token comment">// 用于请求的选项</span>
<span class="token keyword">var</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
   host<span class="token operator">:</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>
   port<span class="token operator">:</span> <span class="token string">'8080'</span><span class="token punctuation">,</span>
   path<span class="token operator">:</span> <span class="token string">'/index.html'</span>  
<span class="token punctuation">}</span><span class="token punctuation">;</span>
 
<span class="token comment">// 处理响应的回调函数</span>
<span class="token keyword">var</span> <span class="token function-variable function">callback</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token comment">// 不断更新数据</span>
   <span class="token keyword">var</span> body <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
   response<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      body <span class="token operator">+=</span> data<span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   
   response<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 数据接收完成</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 向服务端发送请求</span>
<span class="token keyword">var</span> req <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
req<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>执行 client.js 文件，输出结果如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>$ node  client<span class="token punctuation">.</span>js 
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">&quot;utf-8&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>title<span class="token operator">&gt;</span><span class="token function">菜鸟教程</span><span class="token punctuation">(</span>runoob<span class="token punctuation">.</span>com<span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>我的第一个标题<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>我的第一个段落。<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="node-js-fs-模块"><a href="#node-js-fs-模块" class="header-anchor">#</a> Node.js fs 模块</h2> <h3 id="系统和文件的常识"><a href="#系统和文件的常识" class="header-anchor">#</a> 系统和文件的常识</h3> <ul><li>权限位 mode
<table><thead><tr><th>描述</th> <th>内容</th> <th>内容</th> <th>内容</th></tr></thead> <tbody><tr><td>权限分配</td> <td>文件所有者</td> <td>文件所属组</td> <td>其他用户</td></tr> <tr><td>权限项</td> <td>读</td> <td>写</td> <td>执行</td></tr> <tr><td>字符表示</td> <td>r</td> <td>w</td> <td>x</td></tr> <tr><td>数字</td> <td>4(八进制)</td> <td>2八进制)</td> <td>1八进制)</td></tr></tbody></table></li></ul> <p>在本机上控制台上输入 ls -al，以其中一条为例：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  drwxr<span class="token operator">-</span>xr<span class="token operator">-</span>x    <span class="token number">8</span> xueying  staff    <span class="token number">256</span>  <span class="token number">2</span> <span class="token number">26</span> <span class="token number">20</span><span class="token operator">:</span><span class="token number">32</span> <span class="token punctuation">.</span>ShadowsocksX<span class="token operator">-</span><span class="token constant">NG</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>首先 <code>drwxr-xr-x</code>,一共10位 ，8-6位 文件所有者；5-3位，文件所属组；2-0位，其他用户；第九位：d 目录文件，p 管道文件，l连接文件， - 表示普通文件, s .socket。</p> <ul><li>标识位 flag
主要有：r,r+,w,w+,a,a+,ax,wx+,rs。快速记忆方法，r：读取；w：写入；s：同步；+：增加相反操作；x：排它方式。</li> <li>文件描述符 fd
nodejs中分配数值描述符 ，一般从3开始</li></ul> <h3 id="文件基本操作"><a href="#文件基本操作" class="header-anchor">#</a> 文件基本操作</h3> <ul><li>读取 readFileSync 同步 readFile 异步</li> <li>写入 writeFileSync 同步 writeFile 异步 appendFile appendFileSync 追加写入 copyFileSync copyFile 拷贝写入。异步一般比同步多一个参数（回调）</li> <li>打开 <code>fs.open(&quot;.txt&quot;,&quot;r&quot;,(err,fs)=&gt;{})</code></li> <li>关闭 <code>fs.close(fd,err=&gt;{})</code></li> <li>大型文件读取 fs.read() 实例：</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> buf<span class="token operator">=</span>Buffer<span class="token punctuation">.</span><span class="token function">alloc</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
fs<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;data.txt&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;r&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>fd</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	fs<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>bytesRead<span class="token punctuation">,</span>buffer</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bytesRead<span class="token punctuation">)</span><span class="token comment">//实际字节长度</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buffer<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//内容</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">//六个参数 fd，大小，写入开始，长度，读取开始，回调函数</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>写入 fs.write()</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> buf<span class="token operator">=</span>Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;hshs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//存入buf</span>
fs<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;data.txt&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;r+&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>fd</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	fs<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>size<span class="token punctuation">,</span>buf</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
		fs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span><span class="token parameter">err</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;关闭文件&quot;</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="文件目录基本操作"><a href="#文件目录基本操作" class="header-anchor">#</a> 文件目录基本操作</h3> <ul><li><p>目录权限 查看</p> <p>同步 fs.accessSync(&quot;mulu&quot;) 一般配合 try ... catch 使用</p> <p>异步 fs.access(&quot;mulu&quot;,err=&gt;{ if(err){ console.log(&quot;不可访问&quot;) }})</p></li> <li><p>获取文件目录信息</p> <p>statSync() 同步   stat() 异步</p></li> <li><p>创建目录</p> <p>mkdirSync() 同步 mkdir() 异步</p></li> <li><p>读取目录</p> <p>readdirSync() 同步 readdir() 异步</p></li> <li><p>删除目录</p> <p>rmdirSync() 同步 rmdir() 异步</p></li> <li><p>删除文件</p> <p>unlinkSync() 同步 unlink() 异步</p></li></ul> <p>注意：一般在node里，推荐用异步的方式来获取文件等操作，但可能会遇到异步回调嵌套的问题，一般通过Promise来解决。</p> <p>下面写一个例子，比如获取doc目录下的所有txt文件：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code> <span class="token keyword">const</span> fs<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;fs&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">const</span> path<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">function</span> <span class="token function">getFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	 <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
		 <span class="token keyword">const</span> filePath<span class="token operator">=</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">&quot;./doc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取根目录下doc目录</span>
		 fs<span class="token punctuation">.</span><span class="token function">readdir</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>files</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
			 <span class="token keyword">const</span> fileArr<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
			 files<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">fileName</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
				 fileArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;/doc/&quot;</span><span class="token operator">+</span>fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
			 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			 <span class="token function">resolve</span><span class="token punctuation">(</span>fileArr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取了文件</span>
		 <span class="token punctuation">}</span><span class="token punctuation">)</span>
	 <span class="token punctuation">}</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getFilePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//等待getFile获取完文件，返回这个数据</span>
	 <span class="token keyword">const</span> result<span class="token operator">=</span><span class="token keyword">await</span> <span class="token function">getFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	 <span class="token keyword">return</span> result<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">function</span> <span class="token function">insertDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	 <span class="token function">getFilePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
		 <span class="token comment">//存入数据库的操作</span>
		 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
	 <span class="token punctuation">}</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span>
 <span class="token function">insertDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h2 id="node-js-stream-模块"><a href="#node-js-stream-模块" class="header-anchor">#</a> Node.js stream 模块</h2> <h3 id="流的基本概念"><a href="#流的基本概念" class="header-anchor">#</a> 流的基本概念</h3> <p>流（stream）是 Node.js 中处理流式数据的抽象接口。 stream 模块用于构建实现了流接口的对象。</p> <p>Node.js 提供了多种流对象。 例如，HTTP 服务器的请求和 process.stdout 都是流的实例。</p> <p>流可以是可读的、可写的、或者可读可写的。 所有的流都是 EventEmitter 的实例。</p> <p>访问 stream 模块：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> stream<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;stream&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>为什么要使用流？</strong>
它适合大文件、大数据的处理。它会把文件拆分，然后一块一块的运输。所有说它跟其他处理相比有两点提高：内存效率 和 时间效率。</p> <h3 id="流的类型"><a href="#流的类型" class="header-anchor">#</a> 流的类型</h3> <p>Node.js 中有四种基本的流类型：</p> <ul><li><p>1 .  Writable - 可写入数据的流（例如 fs.createWriteStream()）。</p></li> <li><p>2 .  Readable - 可读取数据的流（例如 fs.createReadStream()）。</p> <p>可读流运作于两种模式之一：<code>流动模式（flowing）</code>或<code>暂停模式（paused）</code>。</p> <ul><li>在流动模式中，数据自动从底层系统读取，并通过 EventEmitter 接口的事件尽可能快地被提供给应用程序。</li> <li>在暂停模式中，必须显式调用 stream.read() 读取数据块。</li></ul> <p><code>所有可读流都开始于暂停模式，可以通过以下方式切换到流动模式</code>：</p> <ul><li>添加 'data' 事件句柄。</li> <li>调用 stream.resume() 方法。</li> <li>调用 stream.pipe() 方法将数据发送到可写流。</li></ul> <p><code>可读流可以通过以下方式切换回暂停模式</code>：</p> <ul><li>如果没有管道目标，则调用 stream.pause()。</li> <li>如果有管道目标，则移除所有管道目标。调用 stream.unpipe() 可以移除多个管道目标。
只有提供了消费或忽略数据的机制后，可读流才会产生数据。 如果消费的机制被禁用或移除，则可读流会停止产生数据。</li></ul></li></ul> <p>为了向后兼容，移除 'data' 事件句柄不会自动地暂停流。 如果有管道目标，一旦目标变为 drain 状态并请求接收数据时，则调用 stream.pause() 也不能保证流会保持暂停模式。</p> <p>如果可读流切换到流动模式，且没有可用的消费者来处理数据，则数据将会丢失。 例如，当调用 readable.resume() 时，没有监听 'data' 事件或 'data' 事件句柄已移除。</p> <p>添加 'readable' 事件句柄会使流自动停止流动，并通过 readable.read() 消费数据。 如果 'readable' 事件句柄被移除，且存在 'data' 事件句柄，则流会再次开始流动。</p> <ul><li>3 . Duplex - 可读又可写的流（例如 net.Socket）。</li> <li>4 . Transform - 在读写过程中可以修改或转换数据的 Duplex 流（例如 zlib.createDeflate()）。</li></ul> <h3 id=""><a href="#" class="header-anchor">#</a></h3> <p><strong>此外</strong>，该模块还包括实用函数 stream.pipeline()、stream.finished() 和 stream.Readable.from()。</p> <p>所有的 Stream 对象都是 <code>EventEmitter</code> 的实例。常用的<code>事件</code>有：</p> <ul><li><p>data - 当有数据可读时触发。</p></li> <li><p>end - 没有更多的数据可读时触发。</p></li> <li><p>error - 在接收和写入过程中发生错误时触发。</p></li> <li><p>finish - 所有数据已被写入到底层系统时触发。</p></li></ul> <h2 id="node-js-net-模块"><a href="#node-js-net-模块" class="header-anchor">#</a> Node.js net 模块</h2> <h3 id="基本概念"><a href="#基本概念" class="header-anchor">#</a> 基本概念</h3> <p>net 模块用于创建基于流的 TCP 或 IPC 的服务器（net.createServer()）与客户端（net.createConnection()）。</p> <p>使用方法如下:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> net <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'net'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="例子"><a href="#例子" class="header-anchor">#</a> 例子</h3> <p>服务端与客户端交互的例子</p> <p><strong>服务端 三步：</strong></p> <ul><li>createServer</li> <li>listen 端口 等待客户端的接入</li> <li>socket data，close 完成客户端交互</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//创建tcp服务</span>
<span class="token keyword">const</span> server<span class="token operator">=</span>net<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">&quot;8000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;listening&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;监听成功 监听的是8000端口&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//一个新的连接建立 触发</span>
server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;connection&quot;</span><span class="token punctuation">,</span><span class="token parameter">socket</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;有新的连接&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span><span class="token parameter">data</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;server端收到client端的data&quot;</span><span class="token punctuation">,</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token comment">//返回客户端数据</span>
		socket<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;你好，我是服务端&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	server<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;close&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;服务器已经连接&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p><strong>客户端 三步：</strong></p> <ul><li>创建socket</li> <li>连接指定ip端口</li> <li>监听data,close 完成与服务端交互</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> net<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;net&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> netSocket<span class="token operator">=</span>net<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">&quot;8000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

netSocket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;连接失败&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
netSocket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;connect&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;客户端与服务器端连接已经建立&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	netSocket<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&quot;你好，我是客户端&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//接收服务器数据</span>
	netSocket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;data&quot;</span><span class="token punctuation">,</span><span class="token parameter">data</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;客户端收到服务端的数据&quot;</span><span class="token punctuation">,</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	    netSocket<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
netSocket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;end&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;客户端关闭连接成功&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>先启动服务端，再启动客户端。就可以看到连接成功。</p> <h3 id="net-server类"><a href="#net-server类" class="header-anchor">#</a> net.server类</h3> <ul><li>创建server  createServer</li> <li>listen()   server.listen(端口号，ip)</li> <li>监听事件 on
<ul><li>listening:当服务器绑定后触发</li> <li>connection 新的连接建立时触发 socket</li> <li>close</li> <li>error</li></ul></li> <li>方法
<ul><li>listen()</li> <li>close()</li> <li>address() 返回绑定地址 空对象</li></ul></li></ul> <h3 id="net-scoket类"><a href="#net-scoket类" class="header-anchor">#</a> net.scoket类</h3> <ul><li>创建一个连接net.connect(端口，ip) localhost</li> <li>监听事件 on
<ul><li>connect</li> <li>data 接收到数据时触发， socket.setEncoding(&quot;utf8&quot;);</li> <li>end</li> <li>timeout</li> <li>error</li></ul></li> <li>方法
<ul><li>connect()</li> <li>write(写入内容) 默认utf8</li> <li>setTimeout</li></ul></li> <li>属性
<ul><li>netSocket.localPort</li> <li>localAddress</li> <li>remotePort</li> <li>remoteAddress</li></ul></li></ul> <p>还有更多的属性和方法，请去node官网api。点后面的参考链接。</p> <h2 id="大规模nodejs项目架构与优化"><a href="#大规模nodejs项目架构与优化" class="header-anchor">#</a> 大规模NodeJS项目架构与优化</h2> <p>下面分为几点来讨论：</p> <ul><li>NodeJS异步IO原理浅析及优化方案
<ul><li>异步IO</li> <li>Node对异步IO的实现</li> <li>几个特殊的API</li> <li>函数式编程在Node中的应用</li> <li>常用的Node控制异步API的技术手段</li></ul></li> <li>NodeJS内存管理机制及内存优化</li> <li>大规模Node站点结构原理分析</li> <li>服务器集群管理与Node集群的应用</li> <li>UV过千万的Node站点真身</li></ul> <h3 id="nodejs异步io原理浅析及优化方案"><a href="#nodejs异步io原理浅析及优化方案" class="header-anchor">#</a> NodeJS异步IO原理浅析及优化方案</h3> <h3 id="异步io的好处"><a href="#异步io的好处" class="header-anchor">#</a> 异步IO的好处</h3> <ul><li>前端通过异步IO可以消除UI堵塞。</li> <li>假设请求资源A的时间为M,请求资源B的时间为N.那么同步的请求耗时为M+N.如果采用异步方式占用时间为Max(M,N)。</li> <li>随着业务的复杂，会引入分布式系统，时间会线性的增加，M+N+...和Max(M,N…)，这会放大同步和异步之间的差异。</li> <li>I/O是昂贵的，分布式I/O是更昂贵的。</li> <li>NodeJS 适用于IO密集型不适用CPU密集型</li></ul> <p><strong>一些底层的知识</strong></p> <p>1.<img src="node_3.png" alt="缓存">  CPU时钟周期： 1/cpu主频 -&gt; 1s/3.1 GH</p> <p>2.<img src="node_4.png" alt="缓存"> p 是并行系统中的处理器数量；f=Ws/W 为串行部分的比例;p-&gt;∞ s=1/f</p> <p>3.操作系统对计算机进行了抽象，将所有输入输出设备抽象为文件。内核在进行文件I/O操作时，通过文件描述符进行管理。应用程序如果需要进行IO需要打开文件描述符，在进行文件和数据的读写。异步IO不带数据直接返回，要获取数据还需要通过文件描述符再次读取。
<img src="node_5.png" alt="缓存"></p> <h3 id="node对异步io的实现"><a href="#node对异步io的实现" class="header-anchor">#</a> Node对异步IO的实现</h3> <p>完美的异步IO应该是应该是应用程序发起非阻塞调用，无需通过遍历或者事件幻想等方式轮询。
<img src="node_6.png" alt="eventloop"></p> <h3 id="几个特殊的api"><a href="#几个特殊的api" class="header-anchor">#</a> 几个特殊的API</h3> <ul><li>1.SetTimeout和SetInterval 线程池不参与</li> <li>2.process.nextTick() 实现类似SetTimeout(function(){},0);每次调用放入队列中，在下一轮循环中取出。</li> <li>3.setImmediate();比process.nextTick()优先级低</li> <li>4.Node如何实现一个Sleep?</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//idle观察者&gt;Promise.then&gt;io观察者&gt;check观察者</span>
<span class="token comment">// process.nextTick()&gt;Promise.then&gt;setTimeoutz&gt;setImmediate</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setImmediate</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
process<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resovle<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">resovle</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//4 6 3 5 1 2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>sleep</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">)</span>
	<span class="token keyword">await</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'world!'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token parameter">ms</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> ms<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="函数式编程在node中的应用"><a href="#函数式编程在node中的应用" class="header-anchor">#</a> 函数式编程在Node中的应用</h3> <ul><li><p>1.高阶函数：可以将函数作为输入或者返回值，形成一种后续传递风格的结果接受方式，而非单一的返回值形式。后续传递风格的程序将函数业务重点从返回值传递到回调函数中。</p> <p>app.use(function(){//todo})。</p> <p>var emitter = new events.EventEmitter;</p> <p>emitter.on(function(){//……….todo})</p></li> <li><p>2.偏函数：指定部分参数产生一个新的定制函数的形式就是偏函数。Node中异步编程非常常见，我们通过哨兵变量会很容易造成业务的混乱。underscore，after变量</p></li></ul> <h3 id="常用的node控制异步技术手段"><a href="#常用的node控制异步技术手段" class="header-anchor">#</a> 常用的Node控制异步技术手段</h3> <ul><li>1.Step、wind（提供等待的异步库）、Bigpipe、Q.js</li> <li>2.Async、Await</li> <li>3.Promise/Defferred是一种先执行异步调用，延迟传递的处理方式。Promise是高级接口，事件是低级接口。低级接口可以构建更多复杂的场景，高级接口一旦定义，不太容易变化，不再有低级接口的灵活性，但对于解决问题非常有效</li> <li>4.由于Node基于V8的原因，目前还不支持协程。协程不是进程或线程，其执行过程更类似于子例程，或者说不带返回值的函数调用。</li> <li>一个程序可以包含多个协程，可以对比与一个进程包含多个线程，因而下面我们来比较协程和线程。我们知道多个线程相对独立，有自己的上下文，切换受系统控制；而协程也相对独立，有自己的上下文，但是其切换由自己控制，由当前协程切换到其他协程由当前协程来控制。</li></ul> <h3 id="内存管理与优化"><a href="#内存管理与优化" class="header-anchor">#</a> 内存管理与优化</h3> <h3 id="v8垃圾回收机制"><a href="#v8垃圾回收机制" class="header-anchor">#</a> V8垃圾回收机制</h3> <ul><li><p>Node使用JavaScript在服务端操作大内存对象受到了一定的限制(堆区)，64位系统下约为1.4GB，栈区32位操作系统下是0.7G.新生代64位是32M 32位是16M</p> <p>node —max-new-space-size app.js:</p> <p>-max-old-space-size app.js</p></li> <li><p>Process.memoryUsage-&gt;rss、heaptTotal、heapUsed</p></li> <li><p>V8的垃圾回收策略主要基于分代式垃圾回收机制。在自动垃圾回收的演变过程中，人们发现没有一种垃圾回收算法能够胜任所有场景。V8中内存分为新生代和老生代两代。新生代为存活时间较短对象，老生代中为存活时间较长的对象。</p></li> <li><p>一句话表示：小孩子尽管玩，到处丢东西大人收.</p></li></ul> <h3 id="scavenge算法"><a href="#scavenge算法" class="header-anchor">#</a> Scavenge算法</h3> <ul><li>在分代基础上，新生代的对象主要通过Scavenge算法进行垃圾回收，再具体实现时主要采用Cheney算法。Cheney算法是一种采用复制的方式实现的垃圾回收算法。它将内存一分为二，每一个空间称为semispace。这两个semispace中一个处于使用，一个处于闲置。处于使用的称之为From,闲置的称之为To.分配对象时先分配到From,当开始进行垃圾回收时，检查From存活对象赋值到To.非存活被释放。然后互换位置。再次进行回收，发现被回收过直接晋升，或者发现To空间已经使用了超过25%。他的缺点是只能使用堆内存的一半，这是一个典型的空间换时间的办法，但是新生代声明周期较短，恰恰就适合这个算法.
<img src="node_7.png" alt="Scavenge"></li></ul> <h3 id="mark-sweep-mark-compact"><a href="#mark-sweep-mark-compact" class="header-anchor">#</a> Mark-Sweep &amp; Mark-compact</h3> <ul><li>V8老生代主要采用Mark-Sweep和Mark-compact,在使用Scavenge不合适。一个是对象较多需要赋值量太大而且还是没能解决空间问题。Mark-Sweep是标记清楚，标记那些死亡的对象，然后清除。但是清除过后出现内存不连续的情况，所以我们要使用Markcompact，他是基于Mark-Sweep演变而来的，他先将活着的对象移到一边，移动完成后，直接清理边界外的内存。当CPU空间不足的时候会非常的高效。V8后续还引入了延迟处理，增量处理，并计划引入并行标记处理.
<img src="node_8.png" alt="老生代"> <img src="node_9.png" alt="回收"></li></ul> <h3 id="v8垃圾回收机制-2"><a href="#v8垃圾回收机制-2" class="header-anchor">#</a> V8垃圾回收机制</h3> <p><img src="node_10.png" alt="回收"></p> <h2 id="爬虫以及robots协议介绍"><a href="#爬虫以及robots协议介绍" class="header-anchor">#</a> 爬虫以及Robots协议介绍</h2> <p><strong>爬虫</strong>，是一种自动获取网页内容的程序。是搜索引擎的重要组成部分，因此搜索引擎优化很大程度上就是针对爬虫而做出的优化。</p> <p><strong>robots.txt</strong>是一个文本文件，robots.txt是一个协议，不是一个命令。robots.txt是爬虫要查看的第一个文件。robots.txt文件告诉爬虫在服务器上什么文件是可以被查看的，搜索机器人就会按照该文件中的内容来确定访问范围。</p> <h3 id="配置爬虫系统和开发环境"><a href="#配置爬虫系统和开发环境" class="header-anchor">#</a> 配置爬虫系统和开发环境</h3> <p>需要用到的Node模块：</p> <ul><li>Express node的server模块</li> <li>Request 相当于前端 $的ajax的方法，是后端发送请求的模块</li> <li>Cheerio 操作从后端拉取过来的数据</li></ul> <p>首先 express 一个新项目 express spider</p> <p>安装：
sudo npm install
流程</p> <ul><li>先在项目里，进入/bin文件夹，node www 起本地的服务</li> <li>在bin目录下 npm install request --save-dev</li> <li>npm install cheerio --save-dev</li> <li>修改app.js ,只留下简单的express 根目录输出，监听3000端口</li> <li>用supervisor start app.js</li> <li>在app.js，使用request 向指定网页，发送请求，返回body</li> <li>利用cheerio 把body给调用。</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> request<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cheerio <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cheerio'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	 <span class="token function">request</span><span class="token punctuation">(</span><span class="token string">&quot;www.baidu.com&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span>response<span class="token punctuation">,</span>body</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	 	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>error<span class="token operator">&amp;&amp;</span>response<span class="token punctuation">.</span>statusCode<span class="token operator">==</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">const</span> $ <span class="token operator">=</span> cheerio<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//cheerio相当于jq来用</span>
			res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
				num<span class="token operator">:</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
	 	<span class="token punctuation">}</span>
	 <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><div class="custom-block warning"><p class="custom-block-title">request被废弃了</p></div> <h3 id="数据推送"><a href="#数据推送" class="header-anchor">#</a> 数据推送</h3> <ul><li>comet</li> <li>websocket</li> <li>SSE</li></ul> <p><strong>comet</strong></p> <p>就是http的长连接</p> <p>案例</p> <ul><li>开启xampp，在tdocs里新建一个datepush文件夹，在里边新建一个html，一个php</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">conn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	$<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
		url<span class="token operator">:</span><span class="token string">'test.php'</span><span class="token punctuation">,</span>
		dataType<span class="token operator">:</span><span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span>
		<span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">conn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">conn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="language- extra-class"><pre><code>&lt;?php
header(&quot;Content-type:appliacation/json;charset=utf-8&quot;);
header(&quot;Cache-Control:max-age=0&quot;);
$res=array('success'=&gt;&quot;ok&quot;,&quot;text&quot;=&gt;&quot;ceshi&quot;);
echo json_encode($res);
sleep(1)
// $i=0;
// while($i&lt;9){
// 	$i++;
// 	sleep(1);
// 	$res=array('success'=&gt;&quot;ok&quot;,&quot;text&quot;=&gt;&quot;ceshi&quot;);
// 	echo json_encode($res);
// 	ob_flush();
// 	flush();
// }
?&gt;
</code></pre></div><p><strong>websocket</strong></p> <p>用于聊天类的项目</p> <p>案例</p> <ul><li>在项目中 express,再安装</li> <li>npm install</li> <li>npm install socket.io --save-dev</li> <li>在views里的index.html需要jq，socket.io这两个js</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//app.js</span>
<span class="token keyword">var</span> logger<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'morgan'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> bodyParser<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'body-parser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> cookieParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cookie-parser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> server<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> io<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'socket.io'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>server<span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'port'</span><span class="token punctuation">,</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PORT</span><span class="token operator">||</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">logger</span><span class="token punctuation">(</span><span class="token string">'dev'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	extended<span class="token operator">:</span><span class="token boolean">false</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cookieParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
io<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'connection'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">socket</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	socket<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">json</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'接收到message'</span><span class="token punctuation">,</span>json<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	socket<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">,</span><span class="token string">&quot;server ready&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//后端传给前端数据</span>
	socket<span class="token punctuation">.</span>broadcast<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">,</span><span class="token string">&quot;server ready&quot;</span><span class="token punctuation">)</span><span class="token comment">//广播给其他用户</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	res<span class="token punctuation">.</span><span class="token function">sendfile</span><span class="token punctuation">(</span><span class="token string">'views/index.html'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'port'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;socket&quot;</span><span class="token operator">+</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'port'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> app<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">//index里调用socket js</span>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">var</span> socket<span class="token operator">=</span>io<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token string">'http://localhost:3000'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;已连接&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		socket<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;连接成功&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//往后台传的数据</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">json</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span>json<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">json</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">,</span>json<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>SSE</strong></p> <p>服务器推送数据的方式</p> <p>案例</p> <ul><li>在xampp里/htdocs里新建一个文件夹，新建一个php，一个html</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> source<span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token parameter">argument</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	source<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">EventSource</span><span class="token punctuation">(</span><span class="token string">'http://127.0.0.1/datepush/data.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	source<span class="token punctuation">.</span><span class="token function-variable function">onopen</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;连接已建立&quot;</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>readyState<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
	source<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;数据&quot;</span><span class="token punctuation">,</span>event<span class="token punctuation">.</span>date<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
	source<span class="token punctuation">.</span><span class="token function-variable function">onerror</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="language- extra-class"><pre><code>&lt;?php
	header(&quot;Content-type:text/event-stream;charset=utf-8&quot;);
	header(&quot;Access-Control-Allow-Origin:http://127.0.0.1/&quot;);
	echo &quot;data:现在北京时间&quot;.date('H:i:s')
?&gt;
</code></pre></div><h3 id="参考链接"><a href="#参考链接" class="header-anchor">#</a> 参考链接</h3> <ul><li><a href="https://www.runoob.com/nodejs/nodejs-tutorial.html" target="_blank" rel="noopener noreferrer">node 基础<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="http://nodejs.cn/api/stream.html" target="_blank" rel="noopener noreferrer">node stream<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/php1.html" class="prev">
        PHP
      </a></span> <span class="next"><a href="/blog/webpack.html">
        Webpack 使用
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a0896f0e.js" defer></script><script src="/assets/js/2.88eb2c00.js" defer></script><script src="/assets/js/23.99088ae7.js" defer></script>
  </body>
</html>
