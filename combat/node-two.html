<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>自动化部署 | 前端日志</title>
    <meta name="generator" content="VuePress 1.9.5">
    
    <meta name="description" content="欢迎访问我的前端日志">
    
    <link rel="preload" href="/assets/css/0.styles.e1700646.css" as="style"><link rel="preload" href="/assets/js/app.a0896f0e.js" as="script"><link rel="preload" href="/assets/js/2.88eb2c00.js" as="script"><link rel="preload" href="/assets/js/43.1b5d99f6.js" as="script"><link rel="prefetch" href="/assets/js/10.d30f3d8f.js"><link rel="prefetch" href="/assets/js/11.e2b957ff.js"><link rel="prefetch" href="/assets/js/12.2da1d6bb.js"><link rel="prefetch" href="/assets/js/13.8ce2c088.js"><link rel="prefetch" href="/assets/js/14.16109f84.js"><link rel="prefetch" href="/assets/js/15.93448cfb.js"><link rel="prefetch" href="/assets/js/16.6f18825f.js"><link rel="prefetch" href="/assets/js/17.be1e4a31.js"><link rel="prefetch" href="/assets/js/18.e635c0f4.js"><link rel="prefetch" href="/assets/js/19.be17ff30.js"><link rel="prefetch" href="/assets/js/20.d142b0c9.js"><link rel="prefetch" href="/assets/js/21.e40d6d09.js"><link rel="prefetch" href="/assets/js/22.071940ae.js"><link rel="prefetch" href="/assets/js/23.99088ae7.js"><link rel="prefetch" href="/assets/js/24.670dab57.js"><link rel="prefetch" href="/assets/js/25.85694927.js"><link rel="prefetch" href="/assets/js/26.461dcdb2.js"><link rel="prefetch" href="/assets/js/27.878ab7f9.js"><link rel="prefetch" href="/assets/js/28.1fcc3f4d.js"><link rel="prefetch" href="/assets/js/29.86923448.js"><link rel="prefetch" href="/assets/js/3.037aac60.js"><link rel="prefetch" href="/assets/js/30.724a5ac7.js"><link rel="prefetch" href="/assets/js/31.ac601726.js"><link rel="prefetch" href="/assets/js/32.765bf8d3.js"><link rel="prefetch" href="/assets/js/33.509ffbda.js"><link rel="prefetch" href="/assets/js/34.5aa96cf1.js"><link rel="prefetch" href="/assets/js/35.f1909c5d.js"><link rel="prefetch" href="/assets/js/36.36538350.js"><link rel="prefetch" href="/assets/js/37.b9375bb3.js"><link rel="prefetch" href="/assets/js/38.193abee5.js"><link rel="prefetch" href="/assets/js/39.b584d1b5.js"><link rel="prefetch" href="/assets/js/4.a0809240.js"><link rel="prefetch" href="/assets/js/40.17832949.js"><link rel="prefetch" href="/assets/js/41.cde349a4.js"><link rel="prefetch" href="/assets/js/42.67b16448.js"><link rel="prefetch" href="/assets/js/44.9ecb1424.js"><link rel="prefetch" href="/assets/js/5.77c6fbd3.js"><link rel="prefetch" href="/assets/js/6.609d5ed0.js"><link rel="prefetch" href="/assets/js/7.9131668e.js"><link rel="prefetch" href="/assets/js/8.f1d4a37a.js"><link rel="prefetch" href="/assets/js/9.8be87860.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e1700646.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">前端日志</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  博客
</a></div><div class="nav-item"><a href="/combat/" class="nav-link router-link-active">
  实战
</a></div><div class="nav-item"><a href="/book/" class="nav-link">
  阅读
</a></div><div class="nav-item"><a href="https://github.com/wumao016" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  博客
</a></div><div class="nav-item"><a href="/combat/" class="nav-link router-link-active">
  实战
</a></div><div class="nav-item"><a href="/book/" class="nav-link">
  阅读
</a></div><div class="nav-item"><a href="https://github.com/wumao016" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>实战</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/combat/express-php.html" class="sidebar-link">Express实战</a></li><li><a href="/combat/node-one.html" class="sidebar-link">Node.js与Vue项目集成</a></li><li><a href="/combat/node-two.html" aria-current="page" class="active sidebar-link">自动化部署</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/combat/node-two.html#效果" class="sidebar-link">效果</a></li><li class="sidebar-sub-header"><a href="/combat/node-two.html#步骤" class="sidebar-link">步骤</a></li></ul></li><li><a href="/combat/node-three.html" class="sidebar-link">性能优化</a></li><li><a href="/combat/cli.html" class="sidebar-link">手写cli</a></li><li><a href="/combat/uni-app.html" class="sidebar-link">uni-app</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="自动化部署"><a href="#自动化部署" class="header-anchor">#</a> 自动化部署</h1> <h2 id="效果"><a href="#效果" class="header-anchor">#</a> 效果</h2> <ul><li>1.将上一个项目，首页的页面内容， 图书展示页⾯ 添加内容分X-TAG 、 PolymerJS、 omi 三种库
<x-books></x-books><x-insert></x-insert></li> <li>2.Gulp 编译原来的node项⽬目 把import &lt;-require。gulp-rollup对原来node的项目进行流清洗。
<ul><li>为什么使⽤Gulp不使⽤Webpack编译NodeJS?</li> <li>(1) Gulp 简单 很简单对es6需要的地方进⾏</li> <li>(2) 清洗他的时候 灵活</li> <li>(3) Webpack 前端包工具 慢！！！</li></ul></li> <li>3.前端分离出来 引入Webpack 编译前端的代码到指定目录</li> <li>4.补全测试 RIZE、 Service 然后部署到Travis、 Jenkins平台根据每次的提交直接提交到远程阿里云、腾讯云</li> <li>5.开发一个命令行 能够创建项目、辅助开发</li></ul> <h2 id="步骤"><a href="#步骤" class="header-anchor">#</a> 步骤</h2> <ul><li>先把之前Node.js与Vue的项目目录修改一下，把 assets、components、views 放到新建的web文件夹下；把 config、controllers、libs、logs、middlewares、models、app.js放到新建的server文件夹下(之后会用 Gulp来处理server文件夹，Webpack来处理web文件夹)。</li> <li>安装一个包，用于并行或者顺序运行多个npm脚本 yarn add npm-run-all -D</li> <li>为了以后webpack更好维护 新建一个scripts用来存放脚本的，安装 yarn add scripty -D，
<ul><li>例如把配置中改成 &quot;client:build&quot;:&quot;scripty&quot;，直接就关联到scripts/client/build.sh</li> <li>再加两个&quot;client:dev&quot;、&quot;client:prod&quot; 方便打包。</li> <li>在执行前要加一下权限，chmod -R +x script</li> <li>再 yarn run client:dev</li></ul></li> <li>同理，把&quot;server:start&quot;也给改了。</li> <li>配置 webpack.config.js
<ul><li>安装 yarn add yargs-parser 把config中的配置引到webpack.config.js里</li> <li>安装 yarn add webpack-merge -D 把配置合并的</li></ul></li> <li>编写多页（MPA）组件和页面。
<ul><li>views分成books、index、layouts三个文件夹。</li> <li>components分成banner、list二个文件夹。</li> <li>banner组件里是切换 首页，添加图书，列表页的。所以index页和list页要引入 用include。</li> <li>list组件是展示的，所以列表页需要引入 用include。</li> <li>把assets文件夹里的先删掉，因为这里放views和components公用的。</li> <li>把组件里html写好。</li> <li>在引入时views不光把模版引入，还要components组件中的css，js静态文件也一起引入。所以改变一下views的结构，books下把页面放在pages文件夹下，然后新建js，books-create.entry和books-list.entry（这个命名一定要一一对应）。index同理。这两个js就是处理加载组件静态文件的。</li> <li>然后在组件中写入一些js和css，例如引入jquery， yarn add jquery。</li></ul></li> <li>让books-create.entry等js 分析静态文件并引入到views里。
<ul><li>在webpack.config.js中，引入glob，并分析.entry 的js。</li> <li>发现一个问题，原目录web和server应该都不是要上线，所以外边加一个文件夹名src。</li> <li>继续配置webpack.config.js，把分析的.entry 的js遍历出来并用正则，获取到books-create，books-list的名字。</li> <li>然后 yarn run client:dev可以把.entry js打包好了。配置一下打包在dist/script下。</li> <li>接下来把js放到相应的views里，安装 yarn add html-webpack-plugin 在config下新建一个htmlAfterPlugin.js</li> <li>在htmlAfterPlugin里编写钩子来把js替换进去。</li> <li>把components再打包过去。在config/dev 里拷贝，安装 yarn add copy-webpack-plugin -D</li> <li>到这里就把前端文件整理完了。</li></ul></li> <li>让Gulp处理后端文件。
<ul><li>流清洗之前先把server里都换成ES6 module</li> <li>安装 Gulp,yarn add gulp -D</li> <li>在 gulpfile里写开发环境、上线环境、清洗环境。</li> <li>webpack和gulp都需要babel，webpack是babel-loader，在webpack.config.js里加配置babel。</li> <li>安装 yarn add -D babel-loader @babel/core @babel/preset-env</li> <li>然后是gulp，在gulpfile 配置gulp-watch、gulp-babel</li> <li>安装 yarn add @babel/plugin-transform-modules-commonjs -D</li> <li>安装 yarn add gulp-watch gulp gulp-babel -D</li> <li>清洗 安装yarn add gulp-rollup -D，让babel不编译src/server/config/index.js，</li> <li>安装 yarn add @rollup/plugin-replace -D 深度的tree shaking</li></ul></li> <li>接下来就是上线准备
<ul><li>在webpack.config.js里设置别名，这样把views里banner路径改@；再设置 externals: jquery，提升webpack打包速度。</li> <li>安装 node-bash-title 这是能把终端上的名字改掉，方便我们知道这个终端在干什么的小工具</li> <li>先把start.sh中地址改成./dist/app.js</li> <li>启动 yarn run server:start</li></ul></li></ul> <p><a href="https://github.com/wumao016/webpack-gulp-project" target="_blank" rel="noopener noreferrer">代码地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/combat/node-one.html" class="prev">
        Node.js与Vue项目集成
      </a></span> <span class="next"><a href="/combat/node-three.html">
        性能优化
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a0896f0e.js" defer></script><script src="/assets/js/2.88eb2c00.js" defer></script><script src="/assets/js/43.1b5d99f6.js" defer></script>
  </body>
</html>
